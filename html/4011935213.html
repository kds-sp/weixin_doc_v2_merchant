<!DOCTYPE html>
    <html>
      <head>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <meta />
        
    <title>JSAPI调起支付_产品文档（V2）|微信支付商户文档中心</title><meta>
    <meta>
    
    
    
    
  
      </head>
      <body>
        
        <div><section><header><div><div><div><a><img></a></div><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div><div><div> 文档中心 </div><img></div></div></div><div><img><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div></div></header><section><div><div><div><div><a>产品文档（V2）</a><a>通用规则</a><a>SDK&amp;开发工具</a><a>更新日志</a></div></div><div><div><div><img><div>产品文档（V2）</div></div></div><div><button><span> 技术咨询 </span></button></div></div></div></div></section><section><aside><div><div><ul><li><section><p><span><span>支付产品</span></span><span></span></p><ul><li><section><p><span><span>付款码支付</span></span><span></span></p></section></li><li><section><p><span><span>JSAPI支付</span></span><span></span></p><ul><li><div><a><span>支付账户</span></a></div></li><li><div><a><span>场景介绍</span></a></div></li><li><div><a><span>案例介绍</span></a></div></li><li><div><a><span>接入前准备</span></a></div></li><li><div><a><span>协议规则</span></a></div></li><li><div><a><span>开发指引</span></a></div></li><li><div><a><span>获取微信版本号</span></a></div></li><li><section><p><span><span>API列表</span></span><span></span></p><ul><li><div><a><span>统一下单</span></a></div></li><li><div><a><span>JSAPI调起支付</span></a></div></li><li><div><a><span>查询订单</span></a></div></li><li><div><a><span>关闭订单</span></a></div></li><li><div><a><span>申请退款</span></a></div></li><li><div><a><span>查询退款</span></a></div></li><li><div><a><span>下载交易账单</span></a></div></li><li><div><a><span>下载资金账单</span></a></div></li><li><div><a><span>支付结果通知</span></a></div></li><li><div><a><span>交易保障</span></a></div></li><li><div><a><span>退款结果通知</span></a></div></li></ul></section></li><li><div><a><span>常见问题</span></a></div></li></ul></section></li><li><section><p><span><span>Native支付</span></span><span></span></p></section></li><li><section><p><span><span>APP支付</span></span><span></span></p></section></li><li><section><p><span><span>H5支付</span></span><span></span></p></section></li><li><section><p><span><span>小程序支付</span></span><span></span></p></section></li></ul></section></li><li><section><p><span><span>运营工具</span></span><span></span></p><ul><li><section><p><span><span>现金红包</span></span><span></span></p></section></li><li><section><p><span><span>小程序红包</span></span><span></span></p></section></li><li><section><p><span><span>付款到银行卡</span></span><span></span></p></section></li><li></li><li><section><p><span><span>委托代扣</span></span><span></span></p></section></li><li></li><li></li></ul></section></li><li><section><p><span><span>扩展工具</span></span><span></span></p><ul><li><section><p><span><span>分账</span></span><span></span></p></section></li><li><section><p><span><span>清关报关</span></span><span></span></p></section></li><li></li><li></li><li></li></ul></section></li></ul></div></div></aside><main><div><main><div><div><h1>JSAPI调起支付</h1><span> 更新时间：2024.11.13</span><div><div><html><head></head><body><div><div><p><span><span>在微信浏览器里面打开H5网页中执行JS调起支付。接口输入输出数据格式为JSON。</span></span></p></div><div><p><span><span>注意：WeixinJSBridge内置对象在其他浏览器中无效。</span></span></p></div><div><p><span><span>getBrandWCPayRequest参数以及返回值定义：</span></span></p></div><div><p><span><span>1、网页端接口请求参数列表</span></span><span><span><span>（参数需要重新进行签名计算，参与签名的参数为：appId、timeStamp、nonceStr、package、signType，参数区分大小写。）</span></span></span></p></div><div><table><colgroup><col><col><col><col><col><col></colgroup><tbody><tr><th><p><span><span>名称</span></span></p></th><th><p><span><span>变量名</span></span></p></th><th><p><span><span>必填</span></span></p></th><th><p><span><span>类型</span></span></p></th><th><p><span><span>示例值</span></span></p></th><th><p><span><span>描述</span></span></p></th></tr><tr><td><p><span><span>公众号id</span></span></p></td><td><p><span><span>appId</span></span></p></td><td><p><span><span>是</span></span></p></td><td><p><span><span>String(16)</span></span></p></td><td><p><span><span>wx8888888888888888</span></span></p></td><td><p><span><span>appId为当前服务商号绑定的appid</span></span></p></td></tr><tr><td><p><span><span>时间戳</span></span></p></td><td><p><span><span>timeStamp</span></span></p></td><td><p><span><span>是</span></span></p></td><td><p><span><span>String(32)</span></span></p></td><td><p><span><span>1414561699</span></span></p></td><td><p><span><span>当前的时间，其他详见</span></span><span><span><a>时间戳规则</a></span></span></p></td></tr><tr><td><p><span><span>随机字符串</span></span></p></td><td><p><span><span>nonceStr</span></span></p></td><td><p><span><span>是</span></span></p></td><td><p><span><span>String(32)</span></span></p></td><td><p><span><span>5K8264ILTKCH16CQ2502SI8ZNMTM67VS</span></span></p></td><td><p><span><span>随机字符串，不长于32位。推荐</span></span><span><span><a>随机数生成算法</a></span></span></p></td></tr><tr><td><p><span><span>订单详情扩展字符串</span></span></p></td><td><p><span><span>package</span></span></p></td><td><p><span><span>是</span></span></p></td><td><p><span><span>String(128)</span></span></p></td><td><p><span><span>prepay_id=123456789</span></span></p></td><td><p><span><span>统一下单接口返回的prepay_id参数值，提交格式如：prepay_id=***</span></span></p></td></tr><tr><td><p><span><span>签名方式</span></span></p></td><td><p><span><span>signType</span></span></p></td><td><p><span><span>是</span></span></p></td><td><p><span><span>String(32)</span></span></p></td><td><p><span><span>MD5</span></span></p></td><td><p><span><span>签名类型，默认为MD5，支持HMAC-SHA256和MD5。</span></span><span><span>注意此处需与统一下单的签名类型一致</span></span></p></td></tr><tr><td><p><span><span>签名</span></span></p></td><td><p><span><span>paySign</span></span></p></td><td><p><span><span>是</span></span></p></td><td><p><span><span>String(64)</span></span></p></td><td><p><span><span>C380BEC2BFD727A4B6845133519F3AD6</span></span></p></td><td><p><span><span>签名，详见</span></span><span><span><a>签名生成算法</a></span></span></p></td></tr></tbody></table></div><div><p><span><span>2、返回结果值说明</span></span></p></div><div><table><tbody><tr><th><p><span><span>返回值</span></span></p></th><th><p><span><span>描述</span></span></p></th></tr><tr><td><p><span><span>get_brand_wcpay_request:ok</span></span></p></td><td><p><span><span>支付成功</span></span></p></td></tr><tr><td><p><span><span>get_brand_wcpay_request:cancel</span></span></p></td><td><p><span><span>支付过程中用户取消</span></span></p></td></tr><tr><td><p><span><span>get_brand_wcpay_request:fail</span></span></p></td><td><p><span><span>支付失败</span></span></p></td></tr></tbody></table></div><div><p><span><span>注：JS API的返回结果get_brand_wcpay_request:ok仅在用户成功完成支付时返回。由于前端交互复杂，get_brand_wcpay_request:cancel或者get_brand_wcpay_request:fail可以统一处理为用户遇到错误或者主动放弃，不必细化区分。</span></span></p></div><div><p><span><span>示例代码如下：</span></span></p></div><div><img><pre><span><span>1</span><span><span>
</span></span></span><span><span>2</span><span><span>function</span><span> </span><span>onBridgeReady</span><span>(</span><span>)</span><span>{</span><span>
</span></span></span><span><span>3</span><span><span>   </span><span>WeixinJSBridge</span><span>.</span><span>invoke</span><span>(</span><span>
</span></span></span><span><span>4</span><span><span>      </span><span>'getBrandWCPayRequest'</span><span>,</span><span> </span><span>{</span><span>
</span></span></span><span><span>5</span><span><span>         </span><span>"appId"</span><span>:</span><span>"wx2421b1c4370ec43b"</span><span>,</span><span>     </span><span>//公众号ID，由商户传入     </span><span>
</span></span></span><span><span>6</span><span><span>         </span><span>"timeStamp"</span><span>:</span><span>"1395712654"</span><span>,</span><span>         </span><span>//时间戳，自1970年以来的秒数     </span><span>
</span></span></span><span><span>7</span><span><span>         </span><span>"nonceStr"</span><span>:</span><span>"e61463f8efa94090b1f366cccfbbb444"</span><span>,</span><span> </span><span>//随机串     </span><span>
</span></span></span><span><span>8</span><span><span>         </span><span>"package"</span><span>:</span><span>"prepay_id=u802345jgfjsdfgsdg888"</span><span>,</span><span>     </span><span>
</span></span></span><span><span>9</span><span><span>         </span><span>"signType"</span><span>:</span><span>"MD5"</span><span>,</span><span>         </span><span>//微信签名方式：     </span><span>
</span></span></span><span><span>10</span><span><span>         </span><span>"paySign"</span><span>:</span><span>"70EA570631E4BB79628FBCA90534C63FF7FADD89"</span><span> </span><span>//微信签名 </span><span>
</span></span></span><span><span>11</span><span><span>      </span><span>}</span><span>,</span><span>
</span></span></span><span><span>12</span><span><span>      </span><span>function</span><span>(</span><span>res</span><span>)</span><span>{</span><span>
</span></span></span><span><span>13</span><span><span>      </span><span>if</span><span>(</span><span>res</span><span>.</span><span>err_msg</span><span> </span><span>==</span><span> </span><span>"get_brand_wcpay_request:ok"</span><span> </span><span>)</span><span>{</span><span>
</span></span></span><span><span>14</span><span><span>      </span><span>// 使用以上方式判断前端返回,微信团队郑重提示：</span><span>
</span></span></span><span><span>15</span><span><span>            </span><span>//res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。</span><span>
</span></span></span><span><span>16</span><span><span>      </span><span>}</span><span> </span><span>
</span></span></span><span><span>17</span><span><span>   </span><span>}</span><span>)</span><span>;</span><span> </span><span>
</span></span></span><span><span>18</span><span><span>}</span><span>
</span></span></span><span><span>19</span><span><span>if</span><span> </span><span>(</span><span>typeof</span><span> </span><span>WeixinJSBridge</span><span> </span><span>==</span><span> </span><span>"undefined"</span><span>)</span><span>{</span><span>
</span></span></span><span><span>20</span><span><span>   </span><span>if</span><span>(</span><span> </span><span>document</span><span>.</span><span>addEventListener</span><span> </span><span>)</span><span>{</span><span>
</span></span></span><span><span>21</span><span><span>       </span><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>'WeixinJSBridgeReady'</span><span>,</span><span> </span><span>onBridgeReady</span><span>,</span><span> </span><span>false</span><span>)</span><span>;</span><span>
</span></span></span><span><span>22</span><span><span>   </span><span>}</span><span>else</span><span> </span><span>if</span><span> </span><span>(</span><span>document</span><span>.</span><span>attachEvent</span><span>)</span><span>{</span><span>
</span></span></span><span><span>23</span><span><span>       </span><span>document</span><span>.</span><span>attachEvent</span><span>(</span><span>'WeixinJSBridgeReady'</span><span>,</span><span> </span><span>onBridgeReady</span><span>)</span><span>;</span><span> </span><span>
</span></span></span><span><span>24</span><span><span>       </span><span>document</span><span>.</span><span>attachEvent</span><span>(</span><span>'onWeixinJSBridgeReady'</span><span>,</span><span> </span><span>onBridgeReady</span><span>)</span><span>;</span><span>
</span></span></span><span><span>25</span><span><span>   </span><span>}</span><span>
</span></span></span><span><span>26</span><span><span>}</span><span>else</span><span>{</span><span>
</span></span></span><span><span>27</span><span><span>   </span><span>onBridgeReady</span><span>(</span><span>)</span><span>;</span><span>
</span></span></span><span><span>28</span><span><span>}</span><span>
</span></span></span><span><span>29</span><span></span></span></pre></div><div><p><span><span>3、客户端唤起支付常见错误</span></span></p></div><div><table><tbody><tr><th><p><span><span>序号</span></span></p></th><th><p><span><span>错误描述</span></span></p></th><th><p><span><span>解决方法</span></span></p></th></tr><tr><td><p><span><span><span>1</span></span></span></p></td><td><div><p><span><span>调用支付JSAPI缺少参数：total_fee</span></span></p></div></td><td><p><span><span>1、请检查预支付会话标识prepay_id是否已失效</span></span></p><p><span><span>2、请求的appid与下单接口的appid是否一致</span></span></p></td></tr></tbody></table></div><div><p>&nbsp;</p></div><p>&nbsp;</p></div></body></html></div><div></div></div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><div> 更多支持 </div><div><a>开发文档(服务商)</a><a>开发文档(V2版)</a><a>开发者社区</a><a>微信开放平台</a><a>微信公众平台</a><a>腾讯客服</a></div></div></div></div><div><div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><a><i></i><span>AI开发助手</span></a></div></div><div><div><div><img><img><div> 元宝AI </div></div><div><div><img><img><div> 反馈 </div></div><div><img><img><div> 目录 </div></div><div><img><img><div> 置顶 </div></div></div></div></div></div></div></main><footer><div> Powered By Tencent &amp; Tenpay Copyright 2005-2025 Tenpay All Rights Reserved. </div><div> Powered By Tencent &amp; Tenpay<br>Copyright 2005-2025 Tenpay All Rights Reserved. </div></footer></div></main></section></section></div>
        <div></div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </body>
    </html>