<!DOCTYPE html>
    <html>
      <head>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <meta />
        
    <title>APP端开发步骤_产品文档（V2）|微信支付商户文档中心</title><meta>
    <meta>
    
    
    
    
  
      </head>
      <body>
        
        <div><section><header><div><div><div><a><img></a></div><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div><div><div> 文档中心 </div><img></div></div></div><div><img><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div></div></header><section><div><div><div><div><a>产品文档（V2）</a><a>通用规则</a><a>SDK&amp;开发工具</a><a>更新日志</a></div></div><div><div><div><img><div>产品文档（V2）</div></div></div><div><button><span> 技术咨询 </span></button></div></div></div></div></section><section><aside><div><div><ul><li><section><p><span><span>支付产品</span></span><span></span></p><ul><li><section><p><span><span>付款码支付</span></span><span></span></p></section></li><li><section><p><span><span>JSAPI支付</span></span><span></span></p></section></li><li><section><p><span><span>Native支付</span></span><span></span></p></section></li><li><section><p><span><span>APP支付</span></span><span></span></p><ul><li><div><a><span>支付账户</span></a></div></li><li><div><a><span>场景介绍</span></a></div></li><li><div><a><span>页面推荐示例</span></a></div></li><li><div><a><span>协议规则</span></a></div></li><li><div><a><span>开发指引</span></a></div></li><li><div><a><span>API详细说明</span></a></div></li><li><div><a><span>APP端开发步骤</span></a></div></li><li><section><p><span><span>API列表</span></span><span></span></p></section></li></ul></section></li><li><section><p><span><span>H5支付</span></span><span></span></p></section></li><li><section><p><span><span>小程序支付</span></span><span></span></p></section></li></ul></section></li><li><section><p><span><span>运营工具</span></span><span></span></p><ul><li><section><p><span><span>现金红包</span></span><span></span></p></section></li><li><section><p><span><span>小程序红包</span></span><span></span></p></section></li><li><section><p><span><span>付款到银行卡</span></span><span></span></p></section></li><li></li><li><section><p><span><span>委托代扣</span></span><span></span></p></section></li><li></li><li></li></ul></section></li><li><section><p><span><span>扩展工具</span></span><span></span></p><ul><li><section><p><span><span>分账</span></span><span></span></p></section></li><li><section><p><span><span>清关报关</span></span><span></span></p></section></li><li></li><li></li><li></li></ul></section></li></ul></div></div></aside><main><div><main><div><div><h1>APP端开发步骤</h1><span> 更新时间：2025.05.16</span><div><div><html><head></head><body><div><div><h2><span>IOS系统opensdk升级指引</span></h2></div><div><p><span><span>由于苹果公司在iOS13系统回收了查询 App bundleID 的能力，导致微信无法保证授权凭证能正确返回给AppID对应的应用。为此，微信支付强烈要求所有商户尽快升级到OpenSDK1.8.6，并让用户及时更新APP，否则安全风险将一直存在。谢谢配合！</span></span></p></div><div><p><span><span>详细OpenSDK升级指引请参见：</span></span><span><span><a>opensdk升级指引</a></span></span></p></div><table><tbody><tr><td><table><tbody><tr><td><svg><path></path></svg></td><td><div><p><span><span><span>注意：</span></span></span></p></div><div><p><span><span>opensdk升级后请一定按照文档要求完成验证工作，确保opensdk升级成功。</span></span></p></div></td></tr></tbody></table></td></tr></tbody></table><div><p><span><img></span> <br><span><span>（以上截图来自opensdk升级指引）</span></span></p></div><h2>IOS开发要点说明</h2><p><span><span>以下项目开发环境以Xcode6.0，运行环境为IOS7.0为例，说明其开发中需要的操作。</span></span></p><p><span><span>1、项目设置APPID</span></span></p><p><span><span>商户在微信开放平台申请开发APP应用后，微信开放平台会生成APP的唯一标识APPID。在Xcode中打开项目，设置项目属性中的URL Schemes为您的APPID。如图8.7标红位置所示。</span></span></p><div><p><span><img></span> </p></div><div><p><span><span>图8.7</span></span></p></div><p><span><span>2、注册APPID</span></span></p><p><span><span>商户APP工程中引入微信lib库和头文件，调用API前，需要先向微信注册您的APPID，代码如下：</span></span></p><p><span><span>[WXApi registerApp：@"wxd930ea5d5a258f4f" withDescription：@"demo 2.0"];</span></span></p><p><span><span>3、调起支付</span></span></p><p><span><span>商户服务器生成支付订单，先调用【</span></span><span><span><a>统一下单API</a></span></span><span>】生成预付单，获取到prepay_id后将参数再次签名传输给APP发起支付。以下是调起微信支付的关键代码：</span></p><div><img><pre><span><span>1</span><span><span>
</span></span></span><span><span>2</span><span><span>PayReq *request = [[[PayReq alloc] init] autorelease];</span><span>
</span></span></span><span><span>3</span><span><span>request.partnerId = @"10000100";</span><span>
</span></span></span><span><span>4</span><span><span>request.prepayId= @"1101000000140415649af9fc314aa427";</span><span>
</span></span></span><span><span>5</span><span><span>request.package = @"Sign=WXPay";</span><span>
</span></span></span><span><span>6</span><span><span>request.nonceStr= @"a462b76e7436e98e0ed6e13c64b4fd1c";</span><span>
</span></span></span><span><span>7</span><span><span>request.timeStamp= @"1397527777";</span><span>
</span></span></span><span><span>8</span><span><span>request.sign= @"582282D72DD2B03AD892830965F428CB16E7A256";</span><span>
</span></span></span><span><span>9</span><span><span>[WXApi sendReq：request];</span></span></span></pre></div><p><span><span>注意：该sign生成字段名列表见</span></span><span><span><a>调起支付API</a></span></span></p><p><span><span>4、支付结果回调</span></span></p><p><span><span>照微信SDK Sample，在类实现onResp函数，支付完成后，微信APP会返回到商户APP并回调onResp函数，开发者需要在该函数中接收通知，判断返回错误码，如果支付成功则去后台查询支付结果再展示用户实际支付结果。注意 一定不能以客户端返回作为用户支付的结果，应以服务器端的接收的支付通知或查询API返回的结果为准。代码示例如下：</span></span></p><div><img><pre><span><span>1</span><span><span>
</span></span></span><span><span>2</span><span><span>-(void)onResp：(BaseResp*)resp{</span><span>
</span></span></span><span><span>3</span><span><span>  if ([respisKindOfClass：[PayRespclass]]){</span><span>
</span></span></span><span><span>4</span><span><span>      PayResp*response=(PayResp*)resp;</span><span>
</span></span></span><span><span>5</span><span><span>      switch(response.errCode){</span><span>
</span></span></span><span><span>6</span><span><span>          caseWXSuccess：</span><span>
</span></span></span><span><span>7</span><span><span>          	//服务器端查询支付通知或查询API返回的结果再提示成功</span><span>
</span></span></span><span><span>8</span><span><span>          	NSlog(@"支付成功");</span><span>
</span></span></span><span><span>9</span><span><span>          	break;</span><span>
</span></span></span><span><span>10</span><span><span>          default：</span><span>
</span></span></span><span><span>11</span><span><span>          	NSlog(@"支付失败，retcode=%d",resp.errCode);</span><span>
</span></span></span><span><span>12</span><span><span>          	break;</span><span>
</span></span></span><span><span>13</span><span><span>      }</span><span>
</span></span></span><span><span>14</span><span><span>  }</span><span>
</span></span></span><span><span>15</span><span><span>} </span></span></span></pre></div><p><span><span>回调中errCode值列表：</span></span></p><div><table><colgroup><col><col><col></colgroup><tbody><tr><th><p><span><span>名称</span></span></p></th><th><p><span><span>描述</span></span></p></th><th><p><span><span>解决方案</span></span></p></th></tr><tr><td><p><span><span>0</span></span></p></td><td><p><span><span>成功</span></span></p></td><td><p><span><span>展示成功页面</span></span></p></td></tr><tr><td><p><span><span>-1</span></span></p></td><td><p><span><span>错误</span></span></p></td><td><p><span><span>可能的原因：签名错误、未注册APPID、项目设置APPID不正确、注册的APPID与设置的不匹配、其他异常等。</span></span></p></td></tr><tr><td><p><span><span>-2</span></span></p></td><td><p><span><span>用户取消</span></span></p></td><td><p><span><span>无需处理。发生场景：用户不支付了，点击取消，返回APP。</span></span></p></td></tr></tbody></table></div><div><h2>Android开发要点说明</h2></div><div><p><span><span>1、后台设置</span></span></p></div><div><p><span><span>商户在微信开放平台申请开发应用后，微信开放平台会生成APP的唯一标识APPID。由于需要保证支付安全，需要在开放平台绑定商户应用包名和应用签名，设置好后才能正常发起支付。设置界面在【开放平台】中的栏目【管理中心 / 修改应用 / 修改开发信息】里面，如图8.8红框内所示。</span></span></p></div><div><p><span><img></span> </p></div><div><p><span><span>图8.8</span></span></p></div><p><span><span>应用包名：是在APP项目配置文件AndroidManifest.xml中声明的package值，例如DEMO中的package="net.sourceforge.simcpux"。</span></span></p><p><span><span>应用签名：根据项目的应用包名和编译使用的keystore，可由签名工具生成一个32位的md5串，在调试的手机上安装签名工具后，运行可生成应用签名串，如图8.9所示，绿色串即应用签名。</span></span><span><span><span>点击下载</span></span></span><span><span><a>签名生成工具</a></span></span></p><div><p><span><img></span> </p></div><div><p><span><span>图8.9</span></span></p></div><p><span><span>2、注册APPID</span></span></p><p><span><span>商户APP工程中引入微信JAR包，调用API前，需要先向微信注册您的APPID，代码如下：</span></span></p><p><span><span>final IWXAPI msgApi = WXAPIFactory.createWXAPI(context, null);</span></span></p><p><span><span>// 将该app注册到微信</span></span></p><p><span><span>msgApi.registerApp("wxd930ea5d5a258f4f");</span></span></p><p><span><span>3、调起支付</span></span></p><p><span><span>商户服务器生成支付订单，先调用统一下单API(详见第7节)生成预付单，获取到prepay_id后将参数再次签名传输给APP发起支付。以下是调起微信支付的关键代码：</span></span></p><div><img><pre><span><span>1</span><span><span>
</span></span></span><span><span>2</span><span><span>IWXAPI api;</span><span>
</span></span></span><span><span>3</span><span><span>PayReq request = new PayReq();</span><span>
</span></span></span><span><span>4</span><span><span>request.appId = "wxd930ea5d5a258f4f";</span><span>
</span></span></span><span><span>5</span><span><span>request.partnerId = "1900000109";</span><span>
</span></span></span><span><span>6</span><span><span>request.prepayId= "1101000000140415649af9fc314aa427";</span><span>
</span></span></span><span><span>7</span><span><span>request.packageValue = "Sign=WXPay";</span><span>
</span></span></span><span><span>8</span><span><span>request.nonceStr= "1101000000140429eb40476f8896f4c9";</span><span>
</span></span></span><span><span>9</span><span><span>request.timeStamp= "1398746574";</span><span>
</span></span></span><span><span>10</span><span><span>request.sign= "7FFECB600D7157C5AA49810D2D8F28BC2811827B";</span><span>
</span></span></span><span><span>11</span><span><span>api.sendReq(request);</span></span></span></pre></div><p><span><span>注意：该sign生成字段名列表见</span></span><span><span><a>调起支付API</a></span></span></p><p><span><span>4、支付结果回调</span></span></p><p><span>参考微信</span><span><a>openSDK</a></span><span>，</span><span><span>在商户包名.wxapi包路径中实现WXPayEntryActivity类(包名或类名不一致会造成无法回调)，在WXPayEntryActivity类中实现onResp函数，支付完成后，微信APP会返回到商户APP并回调onResp函数，开发者需要在该函数中接收通知，判断返回错误码，如果支付成功则去后台查询支付结果再展示用户实际支付结果。注意一定不能以客户端返回作为用户支付的结果，应以服务器端的接收的支付通知或查询API返回的结果为准。代码示例如下：</span></span></p><table><tbody><tr><td><table><tbody><tr><td><svg><path></path></svg></td><td><p><span><span>注意：</span></span></p><ul><li><p><span>开发微信支付需要实现WXPayEntryActivity类，否则可能支付完成后，无法从微信内返回到商户APP。</span></p></li><li><p><span>Android13开始Intent过滤器会屏蔽不匹配的intent，存在无法返回商户APP的问题，解决方法：在manifest中，去除WXPayEntryActivity的intent-filter。</span></p></li></ul></td></tr></tbody></table></td></tr></tbody></table><div><img><pre><span><span>1</span><span><span>&lt;activity</span><span>
</span></span></span><span><span>2</span><span><span>    android:name=".wxapi.WXPayEntryActivity"</span><span>
</span></span></span><span><span>3</span><span><span>    android:label="@string/app_name"</span><span>
</span></span></span><span><span>4</span><span><span>    android:theme="@android:style/Theme.Translucent.NoTitleBar"</span><span>
</span></span></span><span><span>5</span><span><span>    android:exported="true"</span><span>
</span></span></span><span><span>6</span><span><span>    android:taskAffinity="填写你的包名"</span><span>
</span></span></span><span><span>7</span><span><span>    android:launchMode="singleTask"&gt;</span><span>
</span></span></span><span><span>8</span><span><span>&lt;/activity&gt;</span></span></span></pre></div><div><img><pre><span><span>1</span><span><span>public void onResp(BaseRespresp){</span><span>
</span></span></span><span><span>2</span><span><span>  	if(resp.getType()==ConstantsAPI.COMMAND_PAY_BY_WX){</span><span>
</span></span></span><span><span>3</span><span><span>  		Log.d(TAG,"onPayFinish,errCode="+resp.errCode);</span><span>
</span></span></span><span><span>4</span><span><span>  		AlertDialog.Builderbuilder=newAlertDialog.Builder(this);</span><span>
</span></span></span><span><span>5</span><span><span>  		builder.setTitle(R.string.app_tip);</span><span>
</span></span></span><span><span>6</span><span><span>  	}</span><span>
</span></span></span><span><span>7</span><span><span>}</span></span></span></pre></div><p><span><span>回调中errCode值列表：</span></span></p><div><table><colgroup><col><col><col></colgroup><tbody><tr><th><p><span><span>名称</span></span></p></th><th><p><span><span>描述</span></span></p></th><th><p><span><span>解决方案</span></span></p></th></tr><tr><td><p><span><span>0</span></span></p></td><td><p><span><span>成功</span></span></p></td><td><p><span><span>展示成功页面</span></span></p></td></tr><tr><td><p><span><span>-1</span></span></p></td><td><p><span><span>错误</span></span></p></td><td><p><span><span>可能的原因：签名错误、未注册APPID、项目设置APPID不正确、注册的APPID与设置的不匹配、其他异常等。</span></span></p></td></tr><tr><td><p><span><span>-2</span></span></p></td><td><p><span><span>用户取消</span></span></p></td><td><p><span><span>无需处理。发生场景：用户不支付了，点击取消，返回APP。</span></span></p></td></tr></tbody></table></div><h2><span>鸿蒙开发要点说明</span></h2><p><span><span>1、配置鸿蒙应用信息</span></span></p><p><span><span>前往</span></span><span><span><span><a>微信开放平台</a></span></span></span><span><span>，在「管理中心 - 移动应用 - 详情 - 开发配置」中点击「编辑」进入修改开发信息的页面，继续在「平台信息」板块中填入鸿蒙应用所需的 Bundle ID 和 identifier 信息，然后提交审核，等待审核通过即可。</span></span></p><div><p><span><img></span> </p></div><p><span><span>关于「鸿蒙应用」中的 Bundle ID、Identifier、以及应用下载地址的提供的说明如下：</span></span></p><ul><li><p><span><span>&nbsp;&nbsp;</span></span><span><span>Bundle ID 指的是鸿蒙应用的包名，</span></span><span><span><a>详情可点击查看</a></span></span></p></li><li><p><span><span>&nbsp;</span></span><span><span>Identifier 指的是鸿蒙应用的 appIdentifier，</span></span><span><span><a>详情可点击查看</a></span></span></p></li></ul><p>&nbsp;</p><p><span><span>注意事项：</span></span></p><ul><li><p><span><span><span>对于 App 已上架 Android 或iOS 应用市场的应用，千万别选择【未上架任何应用市场】，此选项意思是 Android、iOS 和鸿蒙都尚未上架应用市场，而未上架应用市场的应用使用微信能力则有如下的限制，因此开发者需谨慎操作</span></span></span></p></li></ul><div><p><span><img></span> </p></div><ul><li><p><span><span><span>因此，对于 App 已上架 Android 或iOS 应用市场的应用，需选择【已上架至少一个应用市场】，但需填写 App 备案号</span></span></span></p></li></ul><div><p><span><img></span> </p></div><ul><li><p><span><span><span>即，对于 Android 和 iOS 已上架的应用，在下面的配置中一定要选择【是】</span></span></span></p></li></ul><div><p><span><img></span> </p></div><p>&nbsp;</p><p><span><span>2、下载鸿蒙开发的 IDE</span></span></p><p><span><span><span>前往鸿蒙官网下载 </span></span></span><span><span><span><a>DevEco Studio NEXT</a></span></span></span></p><p><span><span>3、配置 sdk 依赖</span></span></p><p><span><span>在 DevEco Studio NEXT中打开你的项目，以 </span></span><span><span><a>demo 工程</a></span></span><span><span>为示例：</span></span></p><p><span><span>修改项目中的oh-package.json5文件，在dependencies中加入微信 opensdk 的依赖项：</span></span></p><div><img><pre><span><span>1</span><span><span>{</span><span>
</span></span></span><span><span>2</span><span><span>  </span><span>"name"</span><span>:</span><span> </span><span>"demo"</span><span>,</span><span>
</span></span></span><span><span>3</span><span><span>  </span><span>"version"</span><span>:</span><span> </span><span>"1.0.0"</span><span>,</span><span>
</span></span></span><span><span>4</span><span><span>  </span><span>"description"</span><span>:</span><span> </span><span>"Please describe the basic information."</span><span>,</span><span>
</span></span></span><span><span>5</span><span><span>  </span><span>"main"</span><span>:</span><span> </span><span>""</span><span>,</span><span>
</span></span></span><span><span>6</span><span><span>  </span><span>"author"</span><span>:</span><span> </span><span>""</span><span>,</span><span>
</span></span></span><span><span>7</span><span><span>  </span><span>"license"</span><span>:</span><span> </span><span>""</span><span>,</span><span>
</span></span></span><span><span>8</span><span><span>   </span><span>"dependencies"</span><span>:</span><span> </span><span>{</span><span>
</span></span></span><span><span>9</span><span><span>    </span><span>"@tencent/wechat_open_sdk"</span><span>:</span><span> </span><span>"1.0.0"</span><span>
</span></span></span><span><span>10</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>11</span><span><span>}</span></span></span></pre></div><p><span><span>4、调起支付</span></span></p><p><span><span><span>商户服务器生成支付订单，先调用【</span></span></span><span><span><a>统一下单API</a></span></span><span><span><span>】生成预付单，获取到prepay_id后将参数再次签名传输给APP发起支付。以下是调起微信支付的关键代码：</span></span></span></p><div><img><pre><span><span>1</span><span><span>import</span><span> </span><span>*</span><span> </span><span>as</span><span> </span><span>wxopensdk</span><span> </span><span>from</span><span> </span><span>'@wechat/open_sdk'</span><span>;</span><span>
</span></span></span><span><span>2</span><span><span>
</span></span></span><span><span>3</span><span><span>// WXApi 是第三方app和微信通信的openApi接口，其实例通过WXAPIFactory获取，需要传入应用申请到的AppID</span><span>
</span></span></span><span><span>4</span><span><span>export</span><span> </span><span>const</span><span> </span><span>WXApi</span><span> </span><span>=</span><span> </span><span>wxopensdk</span><span>.</span><span>WXAPIFactory</span><span>.</span><span>createWXAPI</span><span>(</span><span>APP_ID</span><span>)</span><span>
</span></span></span><span><span>5</span><span><span>
</span></span></span><span><span>6</span><span><span>// WXApiEventHandler为微信数据的回调</span><span>
</span></span></span><span><span>7</span><span><span>class</span><span> </span><span>WXApiEventHandlerImpl</span><span> </span><span>implements</span><span> </span><span>wxopensdk</span><span>.</span><span>WXApiEventHandler</span><span> </span><span>{</span><span>
</span></span></span><span><span>8</span><span><span>  </span><span>private</span><span> </span><span>onReqCallbacks</span><span>:</span><span> </span><span>Map&lt;OnWXReq</span><span>,</span><span> </span><span>OnWXReq&gt;</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Map</span><span>
</span></span></span><span><span>9</span><span><span>  </span><span>private</span><span> </span><span>onRespCallbacks</span><span>:</span><span> </span><span>Map&lt;OnWXResp</span><span>,</span><span> </span><span>OnWXResp&gt;</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Map</span><span>
</span></span></span><span><span>10</span><span><span>
</span></span></span><span><span>11</span><span><span>  </span><span>registerOnWXReqCallback</span><span>(</span><span>on</span><span>:</span><span> </span><span>OnWXReq</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span><span>12</span><span><span>    </span><span>this</span><span>.</span><span>onReqCallbacks</span><span>.</span><span>set</span><span>(</span><span>on</span><span>,</span><span> </span><span>on</span><span>)</span><span>
</span></span></span><span><span>13</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>14</span><span><span>  </span><span>unregisterOnWXReqCallback</span><span>(</span><span>on</span><span>:</span><span> </span><span>OnWXReq</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span><span>15</span><span><span>    </span><span>this</span><span>.</span><span>onReqCallbacks</span><span>.</span><span>delete</span><span>(</span><span>on</span><span>)</span><span>
</span></span></span><span><span>16</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>17</span><span><span>
</span></span></span><span><span>18</span><span><span>  </span><span>registerOnWXRespCallback</span><span>(</span><span>on</span><span>:</span><span> </span><span>OnWXResp</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span><span>19</span><span><span>    </span><span>this</span><span>.</span><span>onRespCallbacks</span><span>.</span><span>set</span><span>(</span><span>on</span><span>,</span><span> </span><span>on</span><span>)</span><span>
</span></span></span><span><span>20</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>21</span><span><span>  </span><span>unregisterOnWXRespCallback</span><span>(</span><span>on</span><span>:</span><span> </span><span>OnWXResp</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span><span>22</span><span><span>    </span><span>this</span><span>.</span><span>onRespCallbacks</span><span>.</span><span>delete</span><span>(</span><span>on</span><span>)</span><span>
</span></span></span><span><span>23</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>24</span><span><span>
</span></span></span><span><span>25</span><span><span>  </span><span>onReq</span><span>(</span><span>req</span><span>:</span><span> </span><span>wxopensdk</span><span>.</span><span>BaseReq</span><span>)</span><span>:</span><span> </span><span>void</span><span> </span><span>{</span><span>
</span></span></span><span><span>26</span><span><span>    </span><span>Log</span><span>.</span><span>i</span><span>(</span><span>kTag</span><span>,</span><span> </span><span>"onReq:%s"</span><span>,</span><span> </span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>req</span><span>)</span><span>)</span><span>
</span></span></span><span><span>27</span><span><span>    </span><span>this</span><span>.</span><span>onReqCallbacks</span><span>.</span><span>forEach</span><span>(</span><span>(</span><span>on</span><span>)</span><span> </span><span>=</span><span>&gt;</span><span> </span><span>{</span><span>
</span></span></span><span><span>28</span><span><span>      </span><span>on</span><span>(</span><span>req</span><span>)</span><span>
</span></span></span><span><span>29</span><span><span>    </span><span>}</span><span>)</span><span>
</span></span></span><span><span>30</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>31</span><span><span>
</span></span></span><span><span>32</span><span><span>  </span><span>onResp</span><span>(</span><span>resp</span><span>:</span><span> </span><span>wxopensdk</span><span>.</span><span>BaseResp</span><span>)</span><span>:</span><span> </span><span>void</span><span> </span><span>{</span><span>
</span></span></span><span><span>33</span><span><span>    </span><span>Log</span><span>.</span><span>i</span><span>(</span><span>kTag</span><span>,</span><span> </span><span>"onResp:%s"</span><span>,</span><span> </span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>resp</span><span>)</span><span>)</span><span>
</span></span></span><span><span>34</span><span><span>    </span><span>this</span><span>.</span><span>onRespCallbacks</span><span>.</span><span>forEach</span><span>(</span><span>(</span><span>on</span><span>)</span><span> </span><span>=</span><span>&gt;</span><span> </span><span>{</span><span>
</span></span></span><span><span>35</span><span><span>      </span><span>on</span><span>(</span><span>resp</span><span>)</span><span>
</span></span></span><span><span>36</span><span><span>    </span><span>}</span><span>)</span><span>
</span></span></span><span><span>37</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>38</span><span><span>}</span><span>
</span></span></span><span><span>39</span><span><span>export</span><span> </span><span>const</span><span> </span><span>WXEventHandler</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>WXApiEventHandlerImpl</span><span>
</span></span></span><span><span>40</span><span><span>
</span></span></span><span><span>41</span><span><span>//调用支付</span><span>
</span></span></span><span><span>42</span><span><span>let</span><span> </span><span>req</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>wxopensdk</span><span>.</span><span>PayReq</span><span>
</span></span></span><span><span>43</span><span><span>req</span><span>.</span><span>appId</span><span> </span><span>=</span><span> </span><span>'wxd930ea5d5a258f4f'</span><span>//微信开放平台审核通过的移动应用AppID</span><span>
</span></span></span><span><span>44</span><span><span>req</span><span>.</span><span>partnerId</span><span> </span><span>=</span><span> </span><span>'1900000109'</span><span>//微信支付商户号</span><span>
</span></span></span><span><span>45</span><span><span>req</span><span>.</span><span>prepayId</span><span> </span><span>=</span><span> </span><span>'1101000000140415649af9fc314aa427'</span><span>//调用微信支付下单接口返回的支付交易会话ID</span><span>
</span></span></span><span><span>46</span><span><span>req</span><span>.</span><span>packageValue</span><span> </span><span>=</span><span> </span><span>'Sign=WXPay'</span><span>//填写固定值Sign=WXPay</span><span>
</span></span></span><span><span>47</span><span><span>req</span><span>.</span><span>nonceStr</span><span> </span><span>=</span><span> </span><span>'1101000000140429eb40476f8896f4c9'</span><span>//随机字符串，不长于32位</span><span>
</span></span></span><span><span>48</span><span><span>req</span><span>.</span><span>timeStamp</span><span> </span><span>=</span><span> </span><span>'1398746574'</span><span>//时间戳</span><span>
</span></span></span><span><span>49</span><span><span>req</span><span>.</span><span>sign</span><span> </span><span>=</span><span> </span><span>'7FFECB600D7157C5AA49810D2D8F28BC2811827B'</span><span>//签名值</span><span>
</span></span></span><span><span>50</span><span><span>// 向微信发送登录请求:</span><span>
</span></span></span><span><span>51</span><span><span>//   context为ohos内置类，app间跳转需依赖该类，开发者可在Component中获取</span><span>
</span></span></span><span><span>52</span><span><span>//   finished为跳转微信的结果：true表示跳转成功；false表示跳转失败，可能是因为微信未安装</span><span>
</span></span></span><span><span>53</span><span><span>let</span><span> </span><span>finished</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>this</span><span>.</span><span>wxApi</span><span>.</span><span>sendReq</span><span>(</span><span>context</span><span>:</span><span> </span><span>common</span><span>.</span><span>UIAbilityContext</span><span>,</span><span> </span><span>req</span><span>)</span><span>
</span></span></span><span><span>54</span><span><span>
</span></span></span><span><span>55</span><span><span>
</span></span></span><span><span>56</span><span><span>// 在EntryAbility中响应来自微信的回调</span><span>
</span></span></span><span><span>57</span><span><span>export</span><span> </span><span>default</span><span> </span><span>class</span><span> </span><span>EntryAbility</span><span> </span><span>extends</span><span> </span><span>UIAbility</span><span> </span><span>{</span><span>
</span></span></span><span><span>58</span><span><span>  </span><span>onCreate</span><span>(</span><span>want</span><span>:</span><span> </span><span>Want</span><span>,</span><span> </span><span>_launchParam</span><span>:</span><span> </span><span>AbilityConstant</span><span>.</span><span>LaunchParam</span><span>)</span><span>:</span><span> </span><span>void</span><span> </span><span>{</span><span>
</span></span></span><span><span>59</span><span><span>    </span><span>this</span><span>.</span><span>handleWeChatCallIfNeed</span><span>(</span><span>want</span><span>)</span><span>
</span></span></span><span><span>60</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>61</span><span><span>  </span><span>
</span></span></span><span><span>62</span><span><span>  </span><span>onNewWant</span><span>(</span><span>want</span><span>:</span><span> </span><span>Want</span><span>,</span><span> </span><span>_launchParam</span><span>:</span><span> </span><span>AbilityConstant</span><span>.</span><span>LaunchParam</span><span>)</span><span>:</span><span> </span><span>void</span><span> </span><span>{</span><span>
</span></span></span><span><span>63</span><span><span>    </span><span>this</span><span>.</span><span>handleWeChatCallIfNeed</span><span>(</span><span>want</span><span>)</span><span>
</span></span></span><span><span>64</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>65</span><span><span>
</span></span></span><span><span>66</span><span><span>  </span><span>private</span><span> </span><span>handleWeChatCallIfNeed</span><span>(</span><span>want</span><span>:</span><span> </span><span>Want</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span><span>67</span><span><span>    </span><span>WXApi</span><span>.</span><span>handleWant</span><span>(</span><span>want</span><span>,</span><span> </span><span>WXEventHandler</span><span>)</span><span>
</span></span></span><span><span>68</span><span><span>  </span><span>}</span><span>
</span></span></span><span><span>69</span><span><span>}</span></span></span></pre></div><table><tbody><tr><td><table><tbody><tr><td><svg><path></path></svg></td><td><p><span><span>注意</span></span></p><p><span>该sign生成字段名列表见</span><span><span><a>调起支付API</a></span></span></p></td></tr></tbody></table></td></tr></tbody></table><p><span><span>5、支付结果回调</span></span></p><p><span><span><span>支付完成后，微信App会返回到商户App并回调onResp函数，开发者需要在该函数中接收通知，判断返回错误码。</span></span></span><span><span><span>如果支付成功则去后台查询支付结果再展示用户实际支付结果。注意一定不能以客户端返回作为用户支付的结果，应以服务器端接收的支付通知或查询API返回的结果为准。</span></span></span></p><p><span><span><span>示例代码：</span></span></span></p><div><img><pre><span><span>1</span><span><span>onResp</span><span>(</span><span>resp</span><span>:</span><span> </span><span>wxopensdk</span><span>.</span><span>BaseResp</span><span>)</span><span>:</span><span> </span><span>void</span><span> </span><span>{</span><span>
</span></span></span><span><span>2</span><span><span>Log</span><span>.</span><span>i</span><span>(</span><span>kTag</span><span>,</span><span> </span><span>"onResp:%s"</span><span>,</span><span> </span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>resp</span><span>)</span><span>)</span><span>
</span></span></span><span><span>3</span><span><span> </span><span>this</span><span>.</span><span>onRespCallbacks</span><span>.</span><span>forEach</span><span>(</span><span>(</span><span>on</span><span>)</span><span> </span><span>=</span><span>&gt;</span><span> </span><span>{</span><span>
</span></span></span><span><span>4</span><span><span> </span><span>on</span><span>(</span><span>resp</span><span>)</span><span>
</span></span></span><span><span>5</span><span><span> </span><span>}</span><span>)</span><span>
</span></span></span><span><span>6</span><span><span> </span><span>}</span></span></span></pre></div><p><span><span><span>回调中errCode值列表：</span></span></span></p><div><table><colgroup><col><col><col></colgroup><tbody><tr><th><p><span><span>值</span></span></p></th><th><p><span><span>描述</span></span></p></th><th><p><span><span>解决方案</span></span></p></th></tr><tr><td><p><span><span>0</span></span></p></td><td><p><span><span>成功</span></span></p></td><td><p><span><span>展示成功页面</span></span></p></td></tr><tr><td><p><span><span>-1</span></span></p></td><td><p><span><span>错误</span></span></p></td><td><p><span><span>可能的原因：签名错误、未注册AppID、项目设置AppID不正确、注册的AppID与设置的不匹配、其他异常等</span></span></p></td></tr><tr><td><p><span><span>-2</span></span></p></td><td><p><span><span>用户取消</span></span></p></td><td><p><span><span>无需处理。发生场景：用户不支付了，点击取消，返回App</span></span></p></td></tr></tbody></table></div><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div></body></html></div><div></div></div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><div> 更多支持 </div><div><a>开发文档(服务商)</a><a>开发文档(V2版)</a><a>开发者社区</a><a>微信开放平台</a><a>微信公众平台</a><a>腾讯客服</a></div></div></div></div><div><div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><a><span>IOS系统opensdk升级指引</span></a></div><div><a><span>IOS开发要点说明</span></a></div><div><a><span>Android开发要点说明</span></a></div><div><a><span>鸿蒙开发要点说明</span></a></div></div><div><a><i></i><span>AI开发助手</span></a></div></div><div><div><div><img><img><div> 元宝AI </div></div><div><div><img><img><div> 反馈 </div></div><div><img><img><div> 目录 </div></div><div><img><img><div> 置顶 </div></div></div></div></div></div></div></main><footer><div> Powered By Tencent &amp; Tenpay Copyright 2005-2025 Tenpay All Rights Reserved. </div><div> Powered By Tencent &amp; Tenpay<br>Copyright 2005-2025 Tenpay All Rights Reserved. </div></footer></div></main></section></section></div>
        <div></div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </body>
    </html>