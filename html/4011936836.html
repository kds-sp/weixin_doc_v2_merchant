<!DOCTYPE html>
    <html lang="zh-CN">
      <head>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <meta charset="UTF-8" />
        
    <title>APP端开发步骤_产品文档（V2）|微信支付商户文档中心</title><meta property="og:title" content="APP端开发步骤_产品文档（V2）|微信支付商户文档中心">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[--><!--]-->
    
    
    
  
      </head>
      <body>
        
        <div id="app"><!--[--><section class="t-layout" data-v-45cd89fe><!--[--><header class="t-layout__header wrap" data-v-45cd89fe data-v-24ca267f><!--[--><div class="header" data-v-24ca267f><div class="header-wrap" data-v-24ca267f><div class="logo" data-v-24ca267f><a href="https://pay.weixin.qq.com/" data-v-24ca267f><img class="logo-partner" src="https://wx.gtimg.com/pay/img/common/logo.svg?v=20190327" alt data-v-24ca267f></a></div><div class="link" data-v-24ca267f><!--[--><a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F" class="" data-v-24ca267f>首页</a><a href="https://pay.weixin.qq.com/static/applyment_guide/applyment_index.shtml" class="" data-v-24ca267f>接入指引</a><a href="https://pay.weixin.qq.com/static/product/product_index.shtml" class="" data-v-24ca267f>产品中心</a><a href="https://pay.weixin.qq.com/static/solution/solution_index.shtml" class="" data-v-24ca267f>解决方案</a><a href="https://pay.weixin.qq.com/doc/v2" class="selected" data-v-24ca267f>文档中心</a><a href="http://pay.weixin.qq.com/index.php/apply/applyment_home/guide_normal" class="btn-primary btn-apply" target="_blank" data-v-24ca267f>接入微信支付</a><!--]--></div><div class="navbar-toggle" data-v-24ca267f><div class="navbar-toggle__des" data-v-24ca267f> 文档中心 </div><img class="navbar-toggle__icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/55b0d9d534b0ccd145bcbe8e932f3053_80x80.svg" alt data-v-24ca267f></div></div></div><!----><div class="navbar-collapse" data-v-24ca267f><img class="close-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/cbbd950ece1f5688079a7f55da0798f9_48x48.svg" alt data-v-24ca267f><div class="link" data-v-24ca267f><!--[--><a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F" class="" data-v-24ca267f>首页</a><a href="https://pay.weixin.qq.com/static/applyment_guide/applyment_index.shtml" class="" data-v-24ca267f>接入指引</a><a href="https://pay.weixin.qq.com/static/product/product_index.shtml" class="" data-v-24ca267f>产品中心</a><a href="https://pay.weixin.qq.com/static/solution/solution_index.shtml" class="" data-v-24ca267f>解决方案</a><a href="https://pay.weixin.qq.com/doc/v3/partner/4012069852" class="selected" data-v-24ca267f>文档中心</a><a href="https://pay.weixin.qq.com/index.php/apply/applyment_home/guide_normal" class="btn-primary btn-apply" target="_blank" data-v-24ca267f>接入微信支付</a><!--]--></div></div><!--]--></header><section class="t-layout subnavbar-layout" data-v-45cd89fe><!--[--><!--[--><div class="sub-navbar" data-v-204f5510><div class="sub-navbar-wrap" data-v-204f5510><div class="segment-nav" data-v-204f5510><div class="segment-nav-left" data-v-204f5510><!--[--><!--[--><a href="javascript:" class="selected" data-v-204f5510>产品文档（V2）</a><!--]--><!--[--><a href="javascript:" class="" data-v-204f5510>通用规则</a><!--]--><!--[--><a href="javascript:" class="" data-v-204f5510>SDK&amp;开发工具</a><!--]--><!--[--><a href="javascript:" class="" data-v-204f5510>更新日志</a><!--]--><!--]--></div><!----></div><div class="segment-nav-box" data-v-204f5510><div class="segment-nav-toggle" data-v-204f5510><div class="sub-navbar-toggle" data-v-204f5510><img class="sub-navbar-toggle__icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/6926a37e3d500f8a9446546bb16252ad_80x80.svg" alt="" data-v-204f5510><div class="sub-navbar-toggle__des" data-v-204f5510>产品文档（V2）</div></div></div><div class="online-service" data-v-204f5510><button class="t-button t-button--variant-base t-button--theme-primary" type="button" href tabindex="0" data-v-204f5510><span class="t-button__text"><!--[--> 技术咨询 <!--]--></span></button></div><!----><!----><!----><!----></div></div></div><!----><!----><!--]--><!--]--></section><section class="t-layout content-layout" data-v-45cd89fe><!--[--><aside class="t-layout__sider wrap" id="sidebar" data-v-45cd89fe data-v-c3fa0a07><!--[--><div class="sidebar" data-v-c3fa0a07><div class="inner" data-v-c3fa0a07><ul class="sidebar-links sidebar-links-spacing" data-v-c3fa0a07><!--[--><li><!--[--><section class="sidebar-group collapsable depth-0"><p class="open sidebar-heading ellipsis"><span><!--[--><span><!--[-->支付产品<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->付款码支付<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->JSAPI支付<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->Native支付<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="open sidebar-heading ellipsis"><span><!--[--><span><!--[-->APP支付<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><div><a href="4011988011.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->支付账户<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011936235.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->场景介绍<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011936606.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->页面推荐示例<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011986620.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->协议规则<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011936686.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->开发指引<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011936775.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->API详细说明<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011936836.html" class="active sidebar-link ellipsis"><!--[--><span><!--[-->APP端开发步骤<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-2"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->API列表<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><!--]--></ul></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->H5支付<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->小程序支付<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><!--]--></ul></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->运营工具<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->现金红包<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->小程序红包<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->付款到银行卡<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!----></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->委托代扣<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!----></li><li><!----></li><!--]--></ul></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->扩展工具<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->分账<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-1"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->清关报关<!--]--></span><!----><!--]--></span><span class="down arrow"></span></p><!----></section><!--]--></li><li><!----></li><li><!----></li><li><!----></li><!--]--></ul></section><!--]--></li><!--]--></ul></div></div><!--]--></aside><main class="t-layout__content" data-v-45cd89fe><!--[--><div class="page-container" data-v-45cd89fe><main class="page" data-v-45cd89fe><div class="page-inner-container" data-v-45cd89fe><div id="page-content" class="page-content" data-v-45cd89fe><h1 class="content-title" data-v-45cd89fe>APP端开发步骤</h1><span class="last-updated-date" data-v-45cd89fe> 更新时间：2025.05.16</span><div id="main-content" class="theme-default-content" data-v-45cd89fe><div data-v-45cd89fe><html><head></head><body><div class="iwiki-wrapper"><div><h2 class="iwiki-h2" id="IOS系统opensdk升级指引"><span>IOS系统opensdk升级指引</span></h2></div><div><p class="iwiki-p"><span><span>由于苹果公司在iOS13系统回收了查询 App bundleID 的能力，导致微信无法保证授权凭证能正确返回给AppID对应的应用。为此，微信支付强烈要求所有商户尽快升级到OpenSDK1.8.6，并让用户及时更新APP，否则安全风险将一直存在。谢谢配合！</span></span></p></div><div><p class="iwiki-p"><span><span>详细OpenSDK升级指引请参见：</span></span><span><span><a href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Access_Guide/iOS.html" target="_blank">opensdk升级指引</a></span></span></p></div><table cellspacing="0" cellpadding="0" border="0" class=" iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel" width="100%"><table cellspacing="0" cellpadding="0" border="0" class="iwiki-panel-innerTable iwiki-panel-type-success iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel-iconTd success" width="24" height="24" valign="top"><svg focusable="false" aria-hidden="true" viewBox="0 0 16 16"><path d="M8 1C4.13 1 1 4.13 1 8C1 11.87 4.13 15 8 15C11.87 15 15 11.87 15 8C15 4.13 11.87 1 8 1ZM11.05 6.59L7.51 10.13C7.41 10.23 7.25 10.23 7.16 10.13L4.95 7.92C4.85 7.82 4.85 7.66 4.95 7.57L5.3 7.22C5.4 7.12 5.56 7.12 5.65 7.22L7.33 8.9L10.34 5.89C10.44 5.79 10.6 5.79 10.69 5.89L11.04 6.24C11.14 6.34 11.14 6.5 11.04 6.59H11.05Z" fill="currentColor"></path></svg></td><td class="iwiki-panel-inner" width="100%"><div><p class="iwiki-p"><span><span><span>注意：</span></span></span></p></div><div><p class="iwiki-p"><span><span>opensdk升级后请一定按照文档要求完成验证工作，确保opensdk升级成功。</span></span></p></div></td></tr></tbody></table></td></tr></tbody></table><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/59dda4e79764acf3bfc851bfacd91996.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="800" height="340"></span> <br><span><span>（以上截图来自opensdk升级指引）</span></span></p></div><h2 class="iwiki-h2" id="IOS开发要点说明">IOS开发要点说明</h2><p class="iwiki-p"><span><span>以下项目开发环境以Xcode6.0，运行环境为IOS7.0为例，说明其开发中需要的操作。</span></span></p><p class="iwiki-p"><span><span>1、项目设置APPID</span></span></p><p class="iwiki-p"><span><span>商户在微信开放平台申请开发APP应用后，微信开放平台会生成APP的唯一标识APPID。在Xcode中打开项目，设置项目属性中的URL Schemes为您的APPID。如图8.7标红位置所示。</span></span></p><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/25cd4ad504ec8f27ce0ff07ca8b21072.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="800" height="547"></span> </p></div><div><p class="iwiki-p"><span><span>图8.7</span></span></p></div><p class="iwiki-p"><span><span>2、注册APPID</span></span></p><p class="iwiki-p"><span><span>商户APP工程中引入微信lib库和头文件，调用API前，需要先向微信注册您的APPID，代码如下：</span></span></p><p class="iwiki-p"><span><span>[WXApi registerApp：@"wxd930ea5d5a258f4f" withDescription：@"demo 2.0"];</span></span></p><p class="iwiki-p"><span><span>3、调起支付</span></span></p><p class="iwiki-p"><span><span>商户服务器生成支付订单，先调用【</span></span><span><span><a href="https://pay.weixin.qq.com/doc/v2/merchant/4011936987" target="_blank">统一下单API</a></span></span><span>】生成预付单，获取到prepay_id后将参数再次签名传输给APP发起支付。以下是调起微信支付的关键代码：</span></p><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>PayReq *request = [[[PayReq alloc] init] autorelease];</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>request.partnerId = @"10000100";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>request.prepayId= @"1101000000140415649af9fc314aa427";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>request.package = @"Sign=WXPay";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span>request.nonceStr= @"a462b76e7436e98e0ed6e13c64b4fd1c";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">7</span><span class="iwiki-codeBlock-line"><span>request.timeStamp= @"1397527777";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">8</span><span class="iwiki-codeBlock-line"><span>request.sign= @"582282D72DD2B03AD892830965F428CB16E7A256";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">9</span><span class="iwiki-codeBlock-line"><span>[WXApi sendReq：request];</span></span></span></pre></div><p class="iwiki-p"><span><span>注意：该sign生成字段名列表见</span></span><span><span><a href="https://pay.weixin.qq.com/doc/v2/merchant/4011937148" target="_blank">调起支付API</a></span></span></p><p class="iwiki-p"><span><span>4、支付结果回调</span></span></p><p class="iwiki-p"><span><span>照微信SDK Sample，在类实现onResp函数，支付完成后，微信APP会返回到商户APP并回调onResp函数，开发者需要在该函数中接收通知，判断返回错误码，如果支付成功则去后台查询支付结果再展示用户实际支付结果。注意 一定不能以客户端返回作为用户支付的结果，应以服务器端的接收的支付通知或查询API返回的结果为准。代码示例如下：</span></span></p><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>-(void)onResp：(BaseResp*)resp{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>  if ([respisKindOfClass：[PayRespclass]]){</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>      PayResp*response=(PayResp*)resp;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>      switch(response.errCode){</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span>          caseWXSuccess：</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">7</span><span class="iwiki-codeBlock-line"><span>          	//服务器端查询支付通知或查询API返回的结果再提示成功</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">8</span><span class="iwiki-codeBlock-line"><span>          	NSlog(@"支付成功");</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">9</span><span class="iwiki-codeBlock-line"><span>          	break;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">10</span><span class="iwiki-codeBlock-line"><span>          default：</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">11</span><span class="iwiki-codeBlock-line"><span>          	NSlog(@"支付失败，retcode=%d",resp.errCode);</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">12</span><span class="iwiki-codeBlock-line"><span>          	break;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">13</span><span class="iwiki-codeBlock-line"><span>      }</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">14</span><span class="iwiki-codeBlock-line"><span>  }</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">15</span><span class="iwiki-codeBlock-line"><span>} </span></span></span></pre></div><p class="iwiki-p"><span><span>回调中errCode值列表：</span></span></p><div class="iwiki-tableNode-wrapper"><table class="iwiki-tableNode" width="100%"><colgroup><col><col><col></colgroup><tbody><tr><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>名称</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>描述</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>解决方案</span></span></p></th></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>0</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>成功</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>展示成功页面</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>-1</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>错误</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>可能的原因：签名错误、未注册APPID、项目设置APPID不正确、注册的APPID与设置的不匹配、其他异常等。</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>-2</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>用户取消</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>无需处理。发生场景：用户不支付了，点击取消，返回APP。</span></span></p></td></tr></tbody></table></div><div><h2 class="iwiki-h2" id="Android开发要点说明">Android开发要点说明</h2></div><div><p class="iwiki-p"><span><span>1、后台设置</span></span></p></div><div><p class="iwiki-p"><span><span>商户在微信开放平台申请开发应用后，微信开放平台会生成APP的唯一标识APPID。由于需要保证支付安全，需要在开放平台绑定商户应用包名和应用签名，设置好后才能正常发起支付。设置界面在【开放平台】中的栏目【管理中心 / 修改应用 / 修改开发信息】里面，如图8.8红框内所示。</span></span></p></div><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/97ca8fa630a560586ff5792af731e343.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="764" height="722"></span> </p></div><div><p class="iwiki-p"><span><span>图8.8</span></span></p></div><p class="iwiki-p"><span><span>应用包名：是在APP项目配置文件AndroidManifest.xml中声明的package值，例如DEMO中的package="net.sourceforge.simcpux"。</span></span></p><p class="iwiki-p"><span><span>应用签名：根据项目的应用包名和编译使用的keystore，可由签名工具生成一个32位的md5串，在调试的手机上安装签名工具后，运行可生成应用签名串，如图8.9所示，绿色串即应用签名。</span></span><span><span><span>点击下载</span></span></span><span><span><a href="https://res.wx.qq.com/wxdoc/dist/assets/media/Gen_Signature_Android.e481f889.zip" target="_blank">签名生成工具</a></span></span></p><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/291b0a4020e3218c468cec402ec0b77a.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="538" height="295"></span> </p></div><div><p class="iwiki-p"><span><span>图8.9</span></span></p></div><p class="iwiki-p"><span><span>2、注册APPID</span></span></p><p class="iwiki-p"><span><span>商户APP工程中引入微信JAR包，调用API前，需要先向微信注册您的APPID，代码如下：</span></span></p><p class="iwiki-p"><span><span>final IWXAPI msgApi = WXAPIFactory.createWXAPI(context, null);</span></span></p><p class="iwiki-p"><span><span>// 将该app注册到微信</span></span></p><p class="iwiki-p"><span><span>msgApi.registerApp("wxd930ea5d5a258f4f");</span></span></p><p class="iwiki-p"><span><span>3、调起支付</span></span></p><p class="iwiki-p"><span><span>商户服务器生成支付订单，先调用统一下单API(详见第7节)生成预付单，获取到prepay_id后将参数再次签名传输给APP发起支付。以下是调起微信支付的关键代码：</span></span></p><div class="iwiki-codeBlock-div" language="none"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>IWXAPI api;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>PayReq request = new PayReq();</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>request.appId = "wxd930ea5d5a258f4f";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>request.partnerId = "1900000109";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span>request.prepayId= "1101000000140415649af9fc314aa427";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">7</span><span class="iwiki-codeBlock-line"><span>request.packageValue = "Sign=WXPay";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">8</span><span class="iwiki-codeBlock-line"><span>request.nonceStr= "1101000000140429eb40476f8896f4c9";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">9</span><span class="iwiki-codeBlock-line"><span>request.timeStamp= "1398746574";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">10</span><span class="iwiki-codeBlock-line"><span>request.sign= "7FFECB600D7157C5AA49810D2D8F28BC2811827B";</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">11</span><span class="iwiki-codeBlock-line"><span>api.sendReq(request);</span></span></span></pre></div><p class="iwiki-p"><span><span>注意：该sign生成字段名列表见</span></span><span><span><a href="https://pay.weixin.qq.com/doc/v2/merchant/4011937148" target="_blank">调起支付API</a></span></span></p><p class="iwiki-p"><span><span>4、支付结果回调</span></span></p><p class="iwiki-p"><span>参考微信</span><span><a href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Access_Guide/Android.html" target="_blank">openSDK</a></span><span>，</span><span><span>在商户包名.wxapi包路径中实现WXPayEntryActivity类(包名或类名不一致会造成无法回调)，在WXPayEntryActivity类中实现onResp函数，支付完成后，微信APP会返回到商户APP并回调onResp函数，开发者需要在该函数中接收通知，判断返回错误码，如果支付成功则去后台查询支付结果再展示用户实际支付结果。注意一定不能以客户端返回作为用户支付的结果，应以服务器端的接收的支付通知或查询API返回的结果为准。代码示例如下：</span></span></p><table cellspacing="0" cellpadding="0" border="0" class=" iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel" width="100%"><table cellspacing="0" cellpadding="0" border="0" class="iwiki-panel-innerTable iwiki-panel-type-success iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel-iconTd success" width="24" height="24" valign="top"><svg focusable="false" aria-hidden="true" viewBox="0 0 16 16"><path d="M8 1C4.13 1 1 4.13 1 8C1 11.87 4.13 15 8 15C11.87 15 15 11.87 15 8C15 4.13 11.87 1 8 1ZM11.05 6.59L7.51 10.13C7.41 10.23 7.25 10.23 7.16 10.13L4.95 7.92C4.85 7.82 4.85 7.66 4.95 7.57L5.3 7.22C5.4 7.12 5.56 7.12 5.65 7.22L7.33 8.9L10.34 5.89C10.44 5.79 10.6 5.79 10.69 5.89L11.04 6.24C11.14 6.34 11.14 6.5 11.04 6.59H11.05Z" fill="currentColor"></path></svg></td><td class="iwiki-panel-inner" width="100%"><p class="iwiki-p"><span><span>注意：</span></span></p><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span>开发微信支付需要实现WXPayEntryActivity类，否则可能支付完成后，无法从微信内返回到商户APP。</span></p></li><li class="iwiki-li"><p class="iwiki-p"><span>Android13开始Intent过滤器会屏蔽不匹配的intent，存在无法返回商户APP的问题，解决方法：在manifest中，去除WXPayEntryActivity的intent-filter。</span></p></li></ul></td></tr></tbody></table></td></tr></tbody></table><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>&lt;activity</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>    android:name=".wxapi.WXPayEntryActivity"</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>    android:label="@string/app_name"</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>    android:theme="@android:style/Theme.Translucent.NoTitleBar"</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>    android:exported="true"</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span>    android:taskAffinity="填写你的包名"</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">7</span><span class="iwiki-codeBlock-line"><span>    android:launchMode="singleTask"&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">8</span><span class="iwiki-codeBlock-line"><span>&lt;/activity&gt;</span></span></span></pre></div><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>public void onResp(BaseRespresp){</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>  	if(resp.getType()==ConstantsAPI.COMMAND_PAY_BY_WX){</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>  		Log.d(TAG,"onPayFinish,errCode="+resp.errCode);</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>  		AlertDialog.Builderbuilder=newAlertDialog.Builder(this);</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>  		builder.setTitle(R.string.app_tip);</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span>  	}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">7</span><span class="iwiki-codeBlock-line"><span>}</span></span></span></pre></div><p class="iwiki-p"><span><span>回调中errCode值列表：</span></span></p><div class="iwiki-tableNode-wrapper"><table class="iwiki-tableNode" width="100%"><colgroup><col><col><col></colgroup><tbody><tr><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>名称</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>描述</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>解决方案</span></span></p></th></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>0</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>成功</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>展示成功页面</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>-1</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>错误</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>可能的原因：签名错误、未注册APPID、项目设置APPID不正确、注册的APPID与设置的不匹配、其他异常等。</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>-2</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>用户取消</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>无需处理。发生场景：用户不支付了，点击取消，返回APP。</span></span></p></td></tr></tbody></table></div><h2 class="iwiki-h2" id="鸿蒙开发要点说明"><span>鸿蒙开发要点说明</span></h2><p class="iwiki-p"><span><span>1、配置鸿蒙应用信息</span></span></p><p class="iwiki-p"><span><span>前往</span></span><span><span><span><a href="https://open.weixin.qq.com/" target="_blank">微信开放平台</a></span></span></span><span><span>，在「管理中心 - 移动应用 - 详情 - 开发配置」中点击「编辑」进入修改开发信息的页面，继续在「平台信息」板块中填入鸿蒙应用所需的 Bundle ID 和 identifier 信息，然后提交审核，等待审核通过即可。</span></span></p><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/e8d516709c342e96fea7f0590b81d1f2.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="800" height="501"></span> </p></div><p class="iwiki-p"><span><span>关于「鸿蒙应用」中的 Bundle ID、Identifier、以及应用下载地址的提供的说明如下：</span></span></p><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span>&nbsp;&nbsp;</span></span><span><span>Bundle ID 指的是鸿蒙应用的包名，</span></span><span><span><a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-createharmonyapp-0000001945392297" target="_blank">详情可点击查看</a></span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>&nbsp;</span></span><span><span>Identifier 指的是鸿蒙应用的 appIdentifier，</span></span><span><span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-bundlemanager-bundleinfo-V5" target="_blank">详情可点击查看</a></span></span></p></li></ul><p class="iwiki-p">&nbsp;</p><p class="iwiki-p"><span><span>注意事项：</span></span></p><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span><span>对于 App 已上架 Android 或iOS 应用市场的应用，千万别选择【未上架任何应用市场】，此选项意思是 Android、iOS 和鸿蒙都尚未上架应用市场，而未上架应用市场的应用使用微信能力则有如下的限制，因此开发者需谨慎操作</span></span></span></p></li></ul><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/4b18d1363fb464f05c18cb1c64cf309c.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="800" height="220"></span> </p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span><span>因此，对于 App 已上架 Android 或iOS 应用市场的应用，需选择【已上架至少一个应用市场】，但需填写 App 备案号</span></span></span></p></li></ul><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/54ee246224da00d021ecacf598c1a4d9.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="800" height="170"></span> </p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span><span>即，对于 Android 和 iOS 已上架的应用，在下面的配置中一定要选择【是】</span></span></span></p></li></ul><div><p class="iwiki-p"><span class="iwiki-inlineExtension-outer iwiki-border-none"><img src="https://gtimg.wechatpay.cn/resource/xres/mmpaydoc/static/img/6e9108bea0c377b859cc70a3cef81301.png" name="image.png" class="iwiki-image iwiki-border-none" type="image" width="800" height="93"></span> </p></div><p class="iwiki-p">&nbsp;</p><p class="iwiki-p"><span><span>2、下载鸿蒙开发的 IDE</span></span></p><p class="iwiki-p"><span><span><span>前往鸿蒙官网下载 </span></span></span><span><span><span><a href="https://developer.huawei.com/consumer/cn/download/" target="_blank">DevEco Studio NEXT</a></span></span></span></p><p class="iwiki-p"><span><span>3、配置 sdk 依赖</span></span></p><p class="iwiki-p"><span><span>在 DevEco Studio NEXT中打开你的项目，以 </span></span><span><span><a href="https://dldir1.qq.com/WechatWebDev/opensdk/ohos/OpenSDK-1.0.0.zip" target="_blank">demo 工程</a></span></span><span><span>为示例：</span></span></p><p class="iwiki-p"><span><span>修改项目中的oh-package.json5文件，在dependencies中加入微信 opensdk 的依赖项：</span></span></p><div class="iwiki-codeBlock-div" language="java"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-string">"name"</span><span>:</span><span> </span><span class="cm-string">"demo"</span><span>,</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-string">"version"</span><span>:</span><span> </span><span class="cm-string">"1.0.0"</span><span>,</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-string">"description"</span><span>:</span><span> </span><span class="cm-string">"Please describe the basic information."</span><span>,</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-string">"main"</span><span>:</span><span> </span><span class="cm-string">""</span><span>,</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-string">"author"</span><span>:</span><span> </span><span class="cm-string">""</span><span>,</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">7</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-string">"license"</span><span>:</span><span> </span><span class="cm-string">""</span><span>,</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">8</span><span class="iwiki-codeBlock-line"><span>   </span><span class="cm-string">"dependencies"</span><span>:</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">9</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-string">"@tencent/wechat_open_sdk"</span><span>:</span><span> </span><span class="cm-string">"1.0.0"</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">10</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">11</span><span class="iwiki-codeBlock-line"><span>}</span></span></span></pre></div><p class="iwiki-p"><span><span>4、调起支付</span></span></p><p class="iwiki-p"><span><span><span>商户服务器生成支付订单，先调用【</span></span></span><span><span><a href="https://pay.weixin.qq.com/doc/v2/merchant/4011936987" target="_blank">统一下单API</a></span></span><span><span><span>】生成预付单，获取到prepay_id后将参数再次签名传输给APP发起支付。以下是调起微信支付的关键代码：</span></span></span></p><div class="iwiki-codeBlock-div" language="java"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span class="cm-keyword">import</span><span> </span><span class="cm-operator">*</span><span> </span><span class="cm-variable">as</span><span> </span><span class="cm-variable">wxopensdk</span><span> </span><span class="cm-variable">from</span><span> </span><span class="cm-string">'@wechat/open_sdk'</span><span>;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span class="cm-comment">// WXApi 是第三方app和微信通信的openApi接口，其实例通过WXAPIFactory获取，需要传入应用申请到的AppID</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span class="cm-variable">export</span><span> </span><span class="cm-keyword">const</span><span> </span><span class="cm-variable">WXApi</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-variable">wxopensdk</span><span>.</span><span class="cm-variable">WXAPIFactory</span><span>.</span><span class="cm-variable">createWXAPI</span><span>(</span><span class="cm-variable">APP_ID</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span class="cm-comment">// WXApiEventHandler为微信数据的回调</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">7</span><span class="iwiki-codeBlock-line"><span class="cm-keyword">class</span><span> </span><span class="cm-def">WXApiEventHandlerImpl</span><span> </span><span class="cm-keyword">implements</span><span> </span><span class="cm-variable">wxopensdk</span><span>.</span><span class="cm-variable">WXApiEventHandler</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">8</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-keyword">private</span><span> </span><span class="cm-variable">onReqCallbacks</span><span>:</span><span> </span><span class="cm-variable">Map&lt;OnWXReq</span><span>,</span><span> </span><span class="cm-variable">OnWXReq&gt;</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-keyword">new</span><span> </span><span class="cm-variable">Map</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">9</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-keyword">private</span><span> </span><span class="cm-variable">onRespCallbacks</span><span>:</span><span> </span><span class="cm-variable">Map&lt;OnWXResp</span><span>,</span><span> </span><span class="cm-variable">OnWXResp&gt;</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-keyword">new</span><span> </span><span class="cm-variable">Map</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">10</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">11</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">registerOnWXReqCallback</span><span>(</span><span class="cm-variable">on</span><span>:</span><span> </span><span class="cm-variable">OnWXReq</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">12</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">onReqCallbacks</span><span>.</span><span class="cm-variable">set</span><span>(</span><span class="cm-variable">on</span><span>,</span><span> </span><span class="cm-variable">on</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">13</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">14</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">unregisterOnWXReqCallback</span><span>(</span><span class="cm-variable">on</span><span>:</span><span> </span><span class="cm-variable">OnWXReq</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">15</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">onReqCallbacks</span><span>.</span><span class="cm-variable">delete</span><span>(</span><span class="cm-variable">on</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">16</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">17</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">18</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">registerOnWXRespCallback</span><span>(</span><span class="cm-variable">on</span><span>:</span><span> </span><span class="cm-variable">OnWXResp</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">19</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">onRespCallbacks</span><span>.</span><span class="cm-variable">set</span><span>(</span><span class="cm-variable">on</span><span>,</span><span> </span><span class="cm-variable">on</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">20</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">21</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">unregisterOnWXRespCallback</span><span>(</span><span class="cm-variable">on</span><span>:</span><span> </span><span class="cm-variable">OnWXResp</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">22</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">onRespCallbacks</span><span>.</span><span class="cm-variable">delete</span><span>(</span><span class="cm-variable">on</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">23</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">24</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">25</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">onReq</span><span>(</span><span class="cm-variable">req</span><span>:</span><span> </span><span class="cm-variable">wxopensdk</span><span>.</span><span class="cm-variable">BaseReq</span><span>)</span><span>:</span><span> </span><span class="cm-type">void</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">26</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-variable">Log</span><span>.</span><span class="cm-variable">i</span><span>(</span><span class="cm-variable">kTag</span><span>,</span><span> </span><span class="cm-string">"onReq:%s"</span><span>,</span><span> </span><span class="cm-variable">JSON</span><span>.</span><span class="cm-variable">stringify</span><span>(</span><span class="cm-variable">req</span><span>)</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">27</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">onReqCallbacks</span><span>.</span><span class="cm-variable">forEach</span><span>(</span><span>(</span><span class="cm-variable">on</span><span>)</span><span> </span><span class="cm-operator">=</span><span class="cm-variable">&gt;</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">28</span><span class="iwiki-codeBlock-line"><span>      </span><span class="cm-variable">on</span><span>(</span><span class="cm-variable">req</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">29</span><span class="iwiki-codeBlock-line"><span>    </span><span>}</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">30</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">31</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">32</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">onResp</span><span>(</span><span class="cm-variable">resp</span><span>:</span><span> </span><span class="cm-variable">wxopensdk</span><span>.</span><span class="cm-variable">BaseResp</span><span>)</span><span>:</span><span> </span><span class="cm-type">void</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">33</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-variable">Log</span><span>.</span><span class="cm-variable">i</span><span>(</span><span class="cm-variable">kTag</span><span>,</span><span> </span><span class="cm-string">"onResp:%s"</span><span>,</span><span> </span><span class="cm-variable">JSON</span><span>.</span><span class="cm-variable">stringify</span><span>(</span><span class="cm-variable">resp</span><span>)</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">34</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">onRespCallbacks</span><span>.</span><span class="cm-variable">forEach</span><span>(</span><span>(</span><span class="cm-variable">on</span><span>)</span><span> </span><span class="cm-operator">=</span><span class="cm-variable">&gt;</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">35</span><span class="iwiki-codeBlock-line"><span>      </span><span class="cm-variable">on</span><span>(</span><span class="cm-variable">resp</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">36</span><span class="iwiki-codeBlock-line"><span>    </span><span>}</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">37</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">38</span><span class="iwiki-codeBlock-line"><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">39</span><span class="iwiki-codeBlock-line"><span class="cm-variable">export</span><span> </span><span class="cm-keyword">const</span><span> </span><span class="cm-variable">WXEventHandler</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-keyword">new</span><span> </span><span class="cm-variable">WXApiEventHandlerImpl</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">40</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">41</span><span class="iwiki-codeBlock-line"><span class="cm-comment">//调用支付</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">42</span><span class="iwiki-codeBlock-line"><span class="cm-variable">let</span><span> </span><span class="cm-variable">req</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-keyword">new</span><span> </span><span class="cm-variable">wxopensdk</span><span>.</span><span class="cm-variable">PayReq</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">43</span><span class="iwiki-codeBlock-line"><span class="cm-variable">req</span><span>.</span><span class="cm-variable">appId</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-string">'wxd930ea5d5a258f4f'</span><span class="cm-comment">//微信开放平台审核通过的移动应用AppID</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">44</span><span class="iwiki-codeBlock-line"><span class="cm-variable">req</span><span>.</span><span class="cm-variable">partnerId</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-string">'1900000109'</span><span class="cm-comment">//微信支付商户号</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">45</span><span class="iwiki-codeBlock-line"><span class="cm-variable">req</span><span>.</span><span class="cm-variable">prepayId</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-string">'1101000000140415649af9fc314aa427'</span><span class="cm-comment">//调用微信支付下单接口返回的支付交易会话ID</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">46</span><span class="iwiki-codeBlock-line"><span class="cm-variable">req</span><span>.</span><span class="cm-variable">packageValue</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-string">'Sign=WXPay'</span><span class="cm-comment">//填写固定值Sign=WXPay</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">47</span><span class="iwiki-codeBlock-line"><span class="cm-variable">req</span><span>.</span><span class="cm-variable">nonceStr</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-string">'1101000000140429eb40476f8896f4c9'</span><span class="cm-comment">//随机字符串，不长于32位</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">48</span><span class="iwiki-codeBlock-line"><span class="cm-variable">req</span><span>.</span><span class="cm-variable">timeStamp</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-string">'1398746574'</span><span class="cm-comment">//时间戳</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">49</span><span class="iwiki-codeBlock-line"><span class="cm-variable">req</span><span>.</span><span class="cm-variable">sign</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-string">'7FFECB600D7157C5AA49810D2D8F28BC2811827B'</span><span class="cm-comment">//签名值</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">50</span><span class="iwiki-codeBlock-line"><span class="cm-comment">// 向微信发送登录请求:</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">51</span><span class="iwiki-codeBlock-line"><span class="cm-comment">//   context为ohos内置类，app间跳转需依赖该类，开发者可在Component中获取</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">52</span><span class="iwiki-codeBlock-line"><span class="cm-comment">//   finished为跳转微信的结果：true表示跳转成功；false表示跳转失败，可能是因为微信未安装</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">53</span><span class="iwiki-codeBlock-line"><span class="cm-variable">let</span><span> </span><span class="cm-variable">finished</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-variable">await</span><span> </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">wxApi</span><span>.</span><span class="cm-variable">sendReq</span><span>(</span><span class="cm-variable">context</span><span>:</span><span> </span><span class="cm-variable">common</span><span>.</span><span class="cm-variable">UIAbilityContext</span><span>,</span><span> </span><span class="cm-variable">req</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">54</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">55</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">56</span><span class="iwiki-codeBlock-line"><span class="cm-comment">// 在EntryAbility中响应来自微信的回调</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">57</span><span class="iwiki-codeBlock-line"><span class="cm-variable">export</span><span> </span><span class="cm-keyword">default</span><span> </span><span class="cm-keyword">class</span><span> </span><span class="cm-def">EntryAbility</span><span> </span><span class="cm-keyword">extends</span><span> </span><span class="cm-variable">UIAbility</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">58</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">onCreate</span><span>(</span><span class="cm-variable">want</span><span>:</span><span> </span><span class="cm-variable">Want</span><span>,</span><span> </span><span class="cm-variable">_launchParam</span><span>:</span><span> </span><span class="cm-variable">AbilityConstant</span><span>.</span><span class="cm-variable">LaunchParam</span><span>)</span><span>:</span><span> </span><span class="cm-type">void</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">59</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">handleWeChatCallIfNeed</span><span>(</span><span class="cm-variable">want</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">60</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">61</span><span class="iwiki-codeBlock-line"><span>  </span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">62</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-variable">onNewWant</span><span>(</span><span class="cm-variable">want</span><span>:</span><span> </span><span class="cm-variable">Want</span><span>,</span><span> </span><span class="cm-variable">_launchParam</span><span>:</span><span> </span><span class="cm-variable">AbilityConstant</span><span>.</span><span class="cm-variable">LaunchParam</span><span>)</span><span>:</span><span> </span><span class="cm-type">void</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">63</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-keyword">this</span><span>.</span><span class="cm-variable">handleWeChatCallIfNeed</span><span>(</span><span class="cm-variable">want</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">64</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">65</span><span class="iwiki-codeBlock-line"><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">66</span><span class="iwiki-codeBlock-line"><span>  </span><span class="cm-keyword">private</span><span> </span><span class="cm-variable">handleWeChatCallIfNeed</span><span>(</span><span class="cm-variable">want</span><span>:</span><span> </span><span class="cm-variable">Want</span><span>)</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">67</span><span class="iwiki-codeBlock-line"><span>    </span><span class="cm-variable">WXApi</span><span>.</span><span class="cm-variable">handleWant</span><span>(</span><span class="cm-variable">want</span><span>,</span><span> </span><span class="cm-variable">WXEventHandler</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">68</span><span class="iwiki-codeBlock-line"><span>  </span><span>}</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">69</span><span class="iwiki-codeBlock-line"><span>}</span></span></span></pre></div><table cellspacing="0" cellpadding="0" border="0" class=" iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel" width="100%"><table cellspacing="0" cellpadding="0" border="0" class="iwiki-panel-innerTable iwiki-panel-type-success iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel-iconTd success" width="24" height="24" valign="top"><svg focusable="false" aria-hidden="true" viewBox="0 0 16 16"><path d="M8 1C4.13 1 1 4.13 1 8C1 11.87 4.13 15 8 15C11.87 15 15 11.87 15 8C15 4.13 11.87 1 8 1ZM11.05 6.59L7.51 10.13C7.41 10.23 7.25 10.23 7.16 10.13L4.95 7.92C4.85 7.82 4.85 7.66 4.95 7.57L5.3 7.22C5.4 7.12 5.56 7.12 5.65 7.22L7.33 8.9L10.34 5.89C10.44 5.79 10.6 5.79 10.69 5.89L11.04 6.24C11.14 6.34 11.14 6.5 11.04 6.59H11.05Z" fill="currentColor"></path></svg></td><td class="iwiki-panel-inner" width="100%"><p class="iwiki-p"><span><span>注意</span></span></p><p class="iwiki-p"><span>该sign生成字段名列表见</span><span><span><a href="https://pay.weixin.qq.com/doc/v2/merchant/4011937148" target="_blank">调起支付API</a></span></span></p></td></tr></tbody></table></td></tr></tbody></table><p class="iwiki-p"><span><span>5、支付结果回调</span></span></p><p class="iwiki-p"><span><span><span>支付完成后，微信App会返回到商户App并回调onResp函数，开发者需要在该函数中接收通知，判断返回错误码。</span></span></span><span><span><span>如果支付成功则去后台查询支付结果再展示用户实际支付结果。注意一定不能以客户端返回作为用户支付的结果，应以服务器端接收的支付通知或查询API返回的结果为准。</span></span></span></p><p class="iwiki-p"><span><span><span>示例代码：</span></span></span></p><div class="iwiki-codeBlock-div" language="javascript"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span class="cm-variable">onResp</span><span>(</span><span class="cm-variable">resp</span><span>:</span><span> </span><span class="cm-variable">wxopensdk</span><span>.</span><span class="cm-variable">BaseResp</span><span>)</span><span>:</span><span> </span><span class="cm-keyword">void</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span class="cm-property">Log</span><span>.</span><span class="cm-variable">i</span><span>(</span><span class="cm-variable">kTag</span><span>,</span><span> </span><span class="cm-string">"onResp:%s"</span><span>,</span><span> </span><span class="cm-variable">JSON</span><span>.</span><span class="cm-variable">stringify</span><span>(</span><span class="cm-variable">resp</span><span>)</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span> </span><span class="cm-keyword">this</span><span>.</span><span class="cm-property">onRespCallbacks</span><span>.</span><span class="cm-property">forEach</span><span>(</span><span>(</span><span class="cm-variable">on</span><span>)</span><span> </span><span class="cm-operator">=</span><span class="cm-variable">&gt;</span><span> </span><span>{</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span> </span><span class="cm-variable">on</span><span>(</span><span class="cm-variable">resp</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span> </span><span>}</span><span>)</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">6</span><span class="iwiki-codeBlock-line"><span> </span><span>}</span></span></span></pre></div><p class="iwiki-p"><span><span><span>回调中errCode值列表：</span></span></span></p><div class="iwiki-tableNode-wrapper"><table class="iwiki-tableNode" width="100%"><colgroup><col><col><col></colgroup><tbody><tr><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>值</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>描述</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" align="left" valign="top"><p class="iwiki-p"><span><span>解决方案</span></span></p></th></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>0</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>成功</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>展示成功页面</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>-1</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>错误</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>可能的原因：签名错误、未注册AppID、项目设置AppID不正确、注册的AppID与设置的不匹配、其他异常等</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>-2</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>用户取消</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="[object Object]"><p class="iwiki-p"><span><span>无需处理。发生场景：用户不支付了，点击取消，返回App</span></span></p></td></tr></tbody></table></div><p class="iwiki-p">&nbsp;</p><p class="iwiki-p">&nbsp;</p><p class="iwiki-p">&nbsp;</p></div></body></html></div><div class="hr-line" data-v-45cd89fe></div></div><div class="feedback-and-moresupport" data-v-45cd89fe><div class="feedback-box" data-v-45cd89fe data-v-77eca616><div class="feedback-panel-text" data-v-77eca616> 文档是否有帮助 </div><!----><div class="feedback-panel-choices" data-v-77eca616><button class="feedback-option" data-v-77eca616><i class="icon help-icon" data-v-77eca616></i>是 </button><button class="feedback-option" data-v-77eca616><i class="icon no-help-icon" data-v-77eca616></i>否 </button></div></div></div><div class="relative-doc-and-moresupport" data-v-45cd89fe><div class="more-support" data-v-45cd89fe data-v-e0c53a30><div class="more-support__title" data-v-e0c53a30> 更多支持 </div><div class="more-support__lists" data-v-e0c53a30><!--[--><a href="https://pay.weixin.qq.com/doc/v3/partner/4012069852" target="_blank" data-v-e0c53a30>开发文档(服务商)</a><a href="https://pay.weixin.qq.com/doc/v2" target="_blank" data-v-e0c53a30>开发文档(V2版)</a><!--]--><a href="https://developers.weixin.qq.com/community/pay" target="_blank" data-v-e0c53a30>开发者社区</a><a href="https://open.weixin.qq.com/" target="_blank" data-v-e0c53a30>微信开放平台</a><a href="https://mp.weixin.qq.com/" target="_blank" data-v-e0c53a30>微信公众平台</a><a href="https://kf.qq.com/product/wechatpaymentmerchant.html" target="_blank" data-v-e0c53a30>腾讯客服</a></div></div></div></div><div class="sub-sidebar" data-v-45cd89fe data-v-7f9bf920><div class="toc" data-v-7f9bf920><div class="mb32" data-v-7f9bf920><div class="feedback-box" data-v-7f9bf920 data-v-77eca616><div class="feedback-panel-text" data-v-77eca616> 文档是否有帮助 </div><!----><div class="feedback-panel-choices" data-v-77eca616><button class="feedback-option" data-v-77eca616><i class="icon help-icon" data-v-77eca616></i>是 </button><button class="feedback-option" data-v-77eca616><i class="icon no-help-icon" data-v-77eca616></i>否 </button></div></div></div><div class="toc-container mb40" data-v-7f9bf920 data-v-c65b4426><!--[--><div class="toc-h2 toc-active toc-item" data-v-c65b4426><a href="4011936836.html#IOS系统opensdk升级指引" title="IOS系统opensdk升级指引" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>IOS系统opensdk升级指引</span></a></div><div class="toc-h2 toc-item" data-v-c65b4426><a href="4011936836.html#IOS开发要点说明" title="IOS开发要点说明" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>IOS开发要点说明</span></a></div><div class="toc-h2 toc-item" data-v-c65b4426><a href="4011936836.html#Android开发要点说明" title="Android开发要点说明" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>Android开发要点说明</span></a></div><div class="toc-h2 toc-item" data-v-c65b4426><a href="4011936836.html#鸿蒙开发要点说明" title="鸿蒙开发要点说明" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>鸿蒙开发要点说明</span></a></div><!--]--></div><div class="support-container" data-v-7f9bf920 data-v-787fd1f1><a href="https://support.pay.weixin.qq.com/aidevhelper?from=wechatpaydoc" target="_blank" class="support-btn" data-v-787fd1f1><i class="support-icon" data-v-787fd1f1></i><span class="support-text" data-v-787fd1f1>AI开发助手</span></a></div></div><div class="toc-mobile" data-v-7f9bf920><div class="sub-sidebar-group" data-v-7f9bf920 data-v-18ea8254><div class="group-item" data-v-18ea8254><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202509/441b156fa07f0548ddda2a0b711b478e_20x20.svg" alt="" data-v-18ea8254><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202511/d17b46871fb8b4187e40e334c9564e6f_84x84.png" alt="" data-v-18ea8254><div class="group-info" data-v-18ea8254> 元宝AI </div></div><div class="group-items" data-v-18ea8254><div class="group-item" data-v-18ea8254><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5c7b6ed2432ae0401a49a60329a1c5c9_80x80.svg" alt="" data-v-18ea8254><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/c2c45e34bb7e9c67c51b22550d44b813_80x80.svg" alt="" data-v-18ea8254><div class="group-info" data-v-18ea8254> 反馈 </div></div><div class="group-item" data-v-18ea8254><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/55b0d9d534b0ccd145bcbe8e932f3053_80x80.svg" alt="" data-v-18ea8254><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/88d0ba6a5d2578733aa9f3c586f07224_80x80.svg" alt="" data-v-18ea8254><div class="group-info" data-v-18ea8254> 目录 </div></div><div class="group-item" data-v-18ea8254><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/70ba1309ab6ade7e84f4f6d006c15621_48x49.png" alt="" data-v-18ea8254><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/eb04b4d41529b9413c0cba2a825c9d95_48x49.png" alt="" data-v-18ea8254><div class="group-info" data-v-18ea8254> 置顶 </div></div></div><!----><!----></div></div></div></div><!----></main><footer class="t-layout__footer footer" data-v-45cd89fe><!--[--><div class="footer-copyright" data-v-45cd89fe> Powered By Tencent &amp; Tenpay Copyright 2005-2025 Tenpay All Rights Reserved. </div><div class="footer-copyright footer-copyright-mobile" data-v-45cd89fe> Powered By Tencent &amp; Tenpay<br data-v-45cd89fe>Copyright 2005-2025 Tenpay All Rights Reserved. </div><!--]--></footer></div><!--]--></main><!--]--></section><!--]--></section><!--]--></div>
        <div id="teleported"></div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </body>
    </html>