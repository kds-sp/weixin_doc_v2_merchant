<!DOCTYPE html>
    <html>
      <head>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <meta />
        
    <title>回调通知注意事项_通用规则|微信支付商户文档中心</title><meta>
    <meta>
    
    
    
    
  
      </head>
      <body>
        
        <div><section><header><div><div><div><a><img></a></div><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div><div><div> 文档中心 </div><img></div></div></div><div><img><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div></div></header><section><div><div><div><div><a>产品文档（V2）</a><a>通用规则</a><a>SDK&amp;开发工具</a><a>更新日志</a></div></div><div><div><div><img><div>通用规则</div></div></div><div><button><span> 技术咨询 </span></button></div></div></div></div></section><section><aside><div><div><ul><li><section><p><span><span>接入规范</span></span><span></span></p><ul><li><div><a><span>商户收银台H5大字号规范</span></a></div></li><li><div><a><span>微信支付二维码规范</span></a></div></li></ul></section></li><li><div><a><span>安全规范</span></a></div></li><li><section><p><span><span>名词表</span></span><span></span></p><ul><li><div><a><span>支付模式</span></a></div></li><li><div><a><span>名词解释</span></a></div></li><li><div><a><span>参数规定</span></a></div></li></ul></section></li><li><section><p><span><span>API安全</span></span><span></span></p><ul><li><div><a><span>最佳安全实践</span></a></div></li><li><div><a><span>安全与网络相关注意事项</span></a></div></li><li><div><a><span>HTTPS服务器配置</span></a></div></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></section></li><li><section><p><span><span>最佳实践</span></span><span></span></p><ul><li><div><a><span>支付回调和查单实现指引</span></a></div></li><li><div><a><span>回调通知注意事项</span></a></div></li><li><div><a><span>专线商户Notify升级指引</span></a></div></li><li><div><a><span>支付验收指引</span></a></div></li><li><div><a><span>跨城冗灾方案</span></a></div></li><li></li></ul></section></li></ul></div></div></aside><main><div><main><div><div><h1>回调通知注意事项</h1><span> 更新时间：2024.11.13</span><div><div><html><head></head><body><div><div><h2><span><span>1、notify_url填写注意事项</span></span></h2><p><span><span><span>● notify_url需要填写商户自己系统的真实地址，不能填写接口文档或demo上的示例地址。</span></span></span><br><span><span><span>● notify_url必须是以https://或http://开头的完整全路径地址，并且确保url中的域名和IP是外网可以访问的，不能填写localhost、127.0.0.1、192.168.x.x等本地或内网IP。</span></span></span><br><span><span><span>● notify_url不能携带参数。</span></span></span><br><span><span><span>● 常见错误举例：</span></span></span></p><div><table><colgroup><col><col></colgroup><tbody><tr><th><p><span><span>错误描述</span></span></p></th><th><p><span><span>错误示例</span></span></p></th></tr><tr><td><p><span><span>url中只有域名，缺少具体的路径</span></span></p></td><td><p><span><span>http://www.weixin.qq.com</span></span></p></td></tr><tr><td><p><span><span>url不是以https://或http://开头，缺少域名或IP</span></span></p></td><td><p><span><span>./PayNotify.aspx</span></span></p></td></tr><tr><td><p><span><span>url中填写了本地或者内网IP</span></span></p></td><td><p><span><span>http://127.0.0.1/pay/notify.php</span></span></p></td></tr><tr><td><p><span><span>填写了不是url格式的字符串</span></span></p></td><td><p><span><span>xxxxxxx，1234567，test</span></span></p></td></tr></tbody></table></div><div><h2><span><span>2、返回报文格式规范</span></span></h2></div><p><span><span>● 返回报文必须是xml格式，字段名需与接口文档说明的一致，报文前后和各字段标签中间不能包含特殊字符。</span></span><br><span><span>● 常见错误举例：</span></span></p><div><table><colgroup><col><col></colgroup><tbody><tr><th><p><span><span>错误描述</span></span></p></th><th><p><span><span>错误示例</span></span></p></th></tr><tr><td><p><span><span>返回内容为空或者非xml格式字符串</span></span></p></td><td><p><span><span>ok，success，支付成功</span></span></p></td></tr><tr><td><p><span><span>返回的xml格式报文中间有其他字符</span></span></p></td><td><p><span><span>&lt;xml&gt;\n&lt;return_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/return_code&gt;</span></span><br><span><span>\n&lt;return_msg&gt;&lt;![CDATA[OK]]&gt;&lt;/return_msg&gt;\n&lt;/xml&gt;</span></span></p></td></tr><tr><td><p><span><span>返回的是json格式</span></span></p></td><td><p><span><span>{"return_code":"SUCCESS";"return_msg":"OK"}</span></span></p></td></tr><tr><td><p><span><span>返回的是整个页面的html代码</span></span></p></td><td><p><span><span>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;&lt;html xmlns="http://www.w3.org/1999/xhtml" &gt;&lt;head&gt;&lt;title&gt;支付成功通知页面&lt;/title&gt;&lt;/head&gt;&lt;body&gt;success&lt;/body&gt;&lt;/html&gt;</span></span></p></td></tr></tbody></table></div><div><h2><span><span>3、回调处理逻辑注意事项</span></span></h2></div><p><span><span>● notify_url的代码处理逻辑不能做登录态校验。</span></span><br><span><span>● 商户系统收到支付结果通知，需要在5秒内返回应答报文，否则微信支付认为通知失败，后续会重复发送通知。</span></span><br><span><span>● 同样的通知可能会多次发送给商户系统，商户系统必须能够正确处理重复的通知。如果已处理过，直接给微信支付返回成功。</span></span><br><span><span>● 商户侧对微信支付回调IP有防火墙策略限制的，需要对以下IP段开通白名单：</span></span></p><div><p><span><span>上海电信出口网段：101.226.103.0/25</span></span><br><span><span>上海联通出口网段：140.207.54.0/25</span></span><br><span><span>上海CAP出口网段：121.51.58.128/25</span></span><br><span><span>深圳电信出口网段：183.3.234.0/25</span></span><br><span><span>深圳联通出口网段：58.251.80.0/25</span></span><br><span><span>深圳CAP出口网段：121.51.30.128/25</span></span><br><span><span>香港出口网段：203.205.219.128/25</span></span><br><span><span>退款结果通知、分账动账通知IP（新增）：</span></span><br><span><span>175.24.214.208、175.24.211.24、175.24.213.135、109.244.180.23、114.132.203.119、43.139.43.69</span></span></p></div></div><p>&nbsp;</p></div></body></html></div><div></div></div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><div> 更多支持 </div><div><a>开发文档(服务商)</a><a>开发文档(V2版)</a><a>开发者社区</a><a>微信开放平台</a><a>微信公众平台</a><a>腾讯客服</a></div></div></div></div><div><div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><a><span>1、notify_url填写注意事项</span></a></div><div><a><span>2、返回报文格式规范</span></a></div><div><a><span>3、回调处理逻辑注意事项</span></a></div></div><div><a><i></i><span>AI开发助手</span></a></div></div><div><div><div><img><img><div> 元宝AI </div></div><div><div><img><img><div> 反馈 </div></div><div><img><img><div> 目录 </div></div><div><img><img><div> 置顶 </div></div></div></div></div></div></div></main><footer><div> Powered By Tencent &amp; Tenpay Copyright 2005-2025 Tenpay All Rights Reserved. </div><div> Powered By Tencent &amp; Tenpay<br>Copyright 2005-2025 Tenpay All Rights Reserved. </div></footer></div></main></section></section></div>
        <div></div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </body>
    </html>