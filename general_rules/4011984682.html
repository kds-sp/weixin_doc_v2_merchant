<!DOCTYPE html>
    <html>
      <head>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <meta />
        
    <title>支付回调和查单实现指引_通用规则|微信支付商户文档中心</title><meta>
    <meta>
    
    
    
    
  
      </head>
      <body>
        
        <div><section><header><div><div><div><a><img></a></div><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div><div><div> 文档中心 </div><img></div></div></div><div><img><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div></div></header><section><div><div><div><div><a>产品文档（V2）</a><a>通用规则</a><a>SDK&amp;开发工具</a><a>更新日志</a></div></div><div><div><div><img><div>通用规则</div></div></div><div><button><span> 技术咨询 </span></button></div></div></div></div></section><section><aside><div><div><ul><li><section><p><span><span>接入规范</span></span><span></span></p><ul><li><div><a><span>商户收银台H5大字号规范</span></a></div></li><li><div><a><span>微信支付二维码规范</span></a></div></li></ul></section></li><li><div><a><span>安全规范</span></a></div></li><li><section><p><span><span>名词表</span></span><span></span></p><ul><li><div><a><span>支付模式</span></a></div></li><li><div><a><span>名词解释</span></a></div></li><li><div><a><span>参数规定</span></a></div></li></ul></section></li><li><section><p><span><span>API安全</span></span><span></span></p><ul><li><div><a><span>最佳安全实践</span></a></div></li><li><div><a><span>安全与网络相关注意事项</span></a></div></li><li><div><a><span>HTTPS服务器配置</span></a></div></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></section></li><li><section><p><span><span>最佳实践</span></span><span></span></p><ul><li><div><a><span>支付回调和查单实现指引</span></a></div></li><li><div><a><span>回调通知注意事项</span></a></div></li><li><div><a><span>专线商户Notify升级指引</span></a></div></li><li><div><a><span>支付验收指引</span></a></div></li><li><div><a><span>跨城冗灾方案</span></a></div></li><li></li></ul></section></li></ul></div></div></aside><main><div><main><div><div><h1>支付回调和查单实现指引</h1><span> 更新时间：2025.03.21</span><div><div><html><head></head><body><div><div><div><h2><span>背景</span></h2></div><div><p><span><span>由于网络异常或者系统的波动，可能会导致用户支付成功，但是商户侧未能成功接收到支付结果通知，进而显示订单未支付的情况。商户侧的订单状态更新不及时，容易造成用户投诉，甚至是重复支付的情况发生。</span></span></p></div><div><h2><span>目标</span></h2></div><div><p><span><span>商户在未能收到支付结果通知时，也能及时、准确地获取到订单的支付状态，提升商户系统的健壮性，减少因为订单状态不同步导致的用户投诉。</span></span></p></div><div><h2><span>方案概述</span></h2></div><div><p><span><img></span> </p></div><p><span><span>1、商户APP或者前端页面收到支付返回时，商户需要调用商户查单接口确认订单状态，并把查询结果展示给用户。</span></span></p><p><span><span>2、商户后台需要准确、高效地处理微信支付发送的异步支付结果通知，并按接口规范把处理结果返回给微信支付。</span></span></p><p><span><span>3、商户后台未收到异步支付结果通知时，商户应该主动调用《</span></span><span><span><a>微信支付查单接口</a></span></span><span>》，同步订单状态。</span></p><p><span><span>4、商户在T+1日从微信支付侧获取T日的交易账单，并与商户系统中的订单核对。如出现订单在微信支付侧成功，但是在商户侧未成功的情况，商户需要给用户补发货或者退款处理。</span></span></p><div><h2><span>前端支付返回处理</span></h2></div><div><p><span><span><span>【公众号、小程序、APP支付】</span></span></span></p></div><div><p><span><span>1、 前端返回“用户取消”的情况，则订单状态保持未支付状态，并提示用户支付未完成。</span></span></p></div><div><p><span><span>2、前端返回“成功”或“报错”的情况，商户需要调用商户查单接口，确认订单状态。</span></span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;1）如果商户查单接口明确返回支付成功，则给用户展示支付成功页。</span></span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;2）如果商户查单接口返回订单未支付，需要提醒用户“稍后进入订单管理页核实订单状态，不要重复发起支付”。商户后端需要及时获取、更新订单状态，实现逻辑参考【</span></span><span><span>后端服务处理</span></span><span>】。当用户再次进入订单管理页面，对未支付的订单再次发起支付时，商户应该使用原单号发起，不要更换支付单号，避免用户重复支付。</span></p></div><div><p><span><span>3、前端调起支付和判断返回类型的方法请参考接口文档：</span></span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;1）</span></span><span><span><a> </a></span></span><span><span><a>JSAPI支付（原公众号支付）</a></span></span><span>。</span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;2） </span></span><span><span><a>小程序支付</a></span></span><span>。</span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;3） </span></span><span><span><a>APP支付</a></span></span><span>。</span></p></div><div><p><span><span><span>【H5支付】</span></span></span></p></div><div><p><span><span>1、前端返回至发起支付的页面或者返回至指定的redirect_url页面，需要在页面设置一个“已完成支付”的按钮让用户点击。</span></span></p></div><div><p><span><img></span> <br><span><span>返回页面展示效果（仅供参考）</span></span></p></div><p><span><span>2、用户点击“已完成支付”按钮，商户需要调用商户查单接口，确认订单状态。</span></span></p><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;1） 如果商户查单接口明确返回支付成功，则给用户展示支付成功页。</span></span></p><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;2） 如果商户查单接口返回订单未支付，需要提醒用户“稍后进入订单管理页核实订单状态，不要重复发起支付”。 商户后端需要及时获取、更新订单状态，实现逻辑参考【</span></span><span><span>后端服务处理】</span></span><span>。当用户再次进入订单管理页面，对未支付的订单再次发起支付时，商户应该使用原单号发起，不要更换支付单号，避免用户重复支付。</span></p><p><span><span><span>【NATIVE支付】</span></span></span></p><p><span><span>前端显示支付二维码之后，前端定时轮询调用商户查单接口确认订单的状态。</span></span></p><div><p><span><img></span> <br><span><span>页面展示效果（仅供参考）</span></span></p></div><p><span><span>比如间隔2秒查询一次，一直轮询60秒。（轮询时间间隔和次数，商户可以根据自身业务场景灵活设置）</span></span></p><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;1）如果轮询商户查单接口返回支付成功，则给用户展示支付成功页。</span></span></p><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;2）如果超过系统设置的时间，商户查单接口仍未返回支付成功，则退出轮询，提醒用户交易超时。</span></span></p><div><h2><span>后端服务处理</span></h2></div><div><p><span><span><span>【支付回调处理】</span></span></span></p></div><div><p><span><span>商户后台需要准确、高效地处理微信支付发送的异步支付结果通知，并按接口规范把处理结果返回给微信支付。详情请参考以下接口规范和注意事项：</span></span></p></div><div><p><span><span>1、</span></span><span><span><a>接口规范</a></span></span></p></div><div><p><span><span>2、</span></span><span><span><a>注意事项</a></span></span></p></div><div><p><span><span><span>【定时轮询查单】</span></span></span></p></div><div><p><span><span>如果长时间没有收到支付结果通知，商户后台应该定时轮询调用《</span></span><span><span><a>微信支付查单接口</a></span></span><span>》去核实订单状态。</span></p></div><div><p><span><span><span>方案一</span></span></span></p></div><div><p><span><span>以订单下单成功时间为基准（或者以前端支付返回成功或者报错后，第一次调用商户查单接口未成功的时间为基准），每隔5秒/30秒/1分钟/3分钟/5分钟/10分钟/30分钟调用《</span></span><span><span><a>微信支付查单接口</a></span></span><span>》查询一次，最后一次查询还是未返回支付成功状态，则停止后续查询，并调用《</span><span><span><a>关单接口</a></span></span><span>》关闭订单。（轮询时间间隔和次数，商户可以根据自身业务场景灵活设置）</span></p></div><div><p><span><span><span>方案二</span></span></span></p></div><div><p><span><span>定时任务每隔30秒启动一次，找出最近10分钟内创建并且未支付的订单，调用《</span></span><span><span><a>微信支付查单接口</a></span></span><span>》核实订单状态。系统记录订单查询的次数，在10次查询之后状态还是未支付成功，则停止后续查询，并调用《</span><span><span><a>关单接口</a></span></span><span>》关闭订单。（轮询时间间隔和次数，商户可以根据自身业务场景灵活设置）</span></p></div><div><p><span><span><span>【T+1日对账处理】</span></span></span></p></div><div><p><span><span>1、商户在T+1日上午10点以后，调用《</span></span><span><span><a>微信支付对账单下载接口</a></span></span><span>》，或者登录微信商户平台手工下载T日交易账单，然后根据对账单中的订单数据，逐笔与商户系统中的订单核对。</span></p></div><div><p><span><span>2、核对时有如下几种情况：</span></span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;1)订单匹配成功，并且状态都是支付成功：正常情况，对账成功。</span></span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;2)订单匹配成功，但是商户侧状态非支付成功：商户根据自身业务情况，决定是否把订单状态更新为支付成功并给用户发货，或者是给用户发起退款。</span></span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;3)订单匹配失败，对账单中的单号在商户系统未找到记录：异常情况，需要商户排查系统是否出现数据异常。</span></span></p></div><div><p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;4)订单匹配失败，商户系统中成功的订单在对账单中未找到记录：异常情况，需要商户排查是否订单处理逻辑有bug。</span></span></p></div><div><h2><span>常见问题</span></h2></div><div><p><span><span>1、前端返回如何区分是成功返回，还是用户取消支付或者异常？</span></span></p></div><div><p><span><span>公众号支付，通过JSAPI返回的res.err_msg值判断：</span></span></p></div><div><p><span><img></span> </p></div><p><span><span>小程序支付，通过回调类型判断：</span></span></p><div><p><span><img></span> </p></div><p><span><span>APP支付，通过onResp函数返回的errCode值判断：</span></span></p><div><p><span><img></span> </p></div><p><span><span>2、如何判断微信支付查单接口返回的订单状态是支付成功？</span></span></p><p><span><span>商户收到《</span></span><span><span><a>微信支付查单接口</a></span></span><span>》的响应报文，验证签名成功，并且返回的return_code、result_code、trade_state这3个参数值同时为SUCCESS，则认为订单是支付成功；调用查单接口遇到网络超时，未收到返回，或者返回的return_code和result_code不同时为SUCCESS，则代表订单状态不明确，需要再次调用查单接口确认。</span></p><p>&nbsp;</p></div><p>&nbsp;</p></div></body></html></div><div></div></div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><div> 更多支持 </div><div><a>开发文档(服务商)</a><a>开发文档(V2版)</a><a>开发者社区</a><a>微信开放平台</a><a>微信公众平台</a><a>腾讯客服</a></div></div></div></div><div><div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><a><span>背景</span></a></div><div><a><span>目标</span></a></div><div><a><span>方案概述</span></a></div><div><a><span>前端支付返回处理</span></a></div><div><a><span>后端服务处理</span></a></div><div><a><span>常见问题</span></a></div></div><div><a><i></i><span>AI开发助手</span></a></div></div><div><div><div><img><img><div> 元宝AI </div></div><div><div><img><img><div> 反馈 </div></div><div><img><img><div> 目录 </div></div><div><img><img><div> 置顶 </div></div></div></div></div></div></div></main><footer><div> Powered By Tencent &amp; Tenpay Copyright 2005-2025 Tenpay All Rights Reserved. </div><div> Powered By Tencent &amp; Tenpay<br>Copyright 2005-2025 Tenpay All Rights Reserved. </div></footer></div></main></section></section></div>
        <div></div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </body>
    </html>