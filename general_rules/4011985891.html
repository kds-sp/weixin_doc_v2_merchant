<!DOCTYPE html>
    <html lang="zh-CN">
      <head>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <meta charset="UTF-8" />
        
    <title>安全规范_通用规则|微信支付商户文档中心</title><meta property="og:title" content="安全规范_通用规则|微信支付商户文档中心">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[--><!--]-->
    
    
    
  
      </head>
      <body>
        
        <div id="app"><!--[--><section class="t-layout" data-v-45cd89fe><!--[--><header class="t-layout__header wrap" data-v-45cd89fe data-v-24ca267f><!--[--><div class="header" data-v-24ca267f><div class="header-wrap" data-v-24ca267f><div class="logo" data-v-24ca267f><a href="https://pay.weixin.qq.com/" data-v-24ca267f><img class="logo-partner" src="https://wx.gtimg.com/pay/img/common/logo.svg?v=20190327" alt data-v-24ca267f></a></div><div class="link" data-v-24ca267f><!--[--><a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F" class="" data-v-24ca267f>首页</a><a href="https://pay.weixin.qq.com/static/applyment_guide/applyment_index.shtml" class="" data-v-24ca267f>接入指引</a><a href="https://pay.weixin.qq.com/static/product/product_index.shtml" class="" data-v-24ca267f>产品中心</a><a href="https://pay.weixin.qq.com/static/solution/solution_index.shtml" class="" data-v-24ca267f>解决方案</a><a href="https://pay.weixin.qq.com/doc/v2" class="selected" data-v-24ca267f>文档中心</a><a href="http://pay.weixin.qq.com/index.php/apply/applyment_home/guide_normal" class="btn-primary btn-apply" target="_blank" data-v-24ca267f>接入微信支付</a><!--]--></div><div class="navbar-toggle" data-v-24ca267f><div class="navbar-toggle__des" data-v-24ca267f> 文档中心 </div><img class="navbar-toggle__icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/55b0d9d534b0ccd145bcbe8e932f3053_80x80.svg" alt data-v-24ca267f></div></div></div><!----><div class="navbar-collapse" data-v-24ca267f><img class="close-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/cbbd950ece1f5688079a7f55da0798f9_48x48.svg" alt data-v-24ca267f><div class="link" data-v-24ca267f><!--[--><a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F" class="" data-v-24ca267f>首页</a><a href="https://pay.weixin.qq.com/static/applyment_guide/applyment_index.shtml" class="" data-v-24ca267f>接入指引</a><a href="https://pay.weixin.qq.com/static/product/product_index.shtml" class="" data-v-24ca267f>产品中心</a><a href="https://pay.weixin.qq.com/static/solution/solution_index.shtml" class="" data-v-24ca267f>解决方案</a><a href="https://pay.weixin.qq.com/doc/v3/partner/4012069852" class="selected" data-v-24ca267f>文档中心</a><a href="https://pay.weixin.qq.com/index.php/apply/applyment_home/guide_normal" class="btn-primary btn-apply" target="_blank" data-v-24ca267f>接入微信支付</a><!--]--></div></div><!--]--></header><section class="t-layout subnavbar-layout" data-v-45cd89fe><!--[--><!--[--><div class="sub-navbar" data-v-204f5510><div class="sub-navbar-wrap" data-v-204f5510><div class="segment-nav" data-v-204f5510><div class="segment-nav-left" data-v-204f5510><!--[--><!--[--><a href="javascript:" class="" data-v-204f5510>产品文档（V2）</a><!--]--><!--[--><a href="javascript:" class="selected" data-v-204f5510>通用规则</a><!--]--><!--[--><a href="javascript:" class="" data-v-204f5510>SDK&amp;开发工具</a><!--]--><!--[--><a href="javascript:" class="" data-v-204f5510>更新日志</a><!--]--><!--]--></div><!----></div><div class="segment-nav-box" data-v-204f5510><div class="segment-nav-toggle" data-v-204f5510><div class="sub-navbar-toggle" data-v-204f5510><img class="sub-navbar-toggle__icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/6926a37e3d500f8a9446546bb16252ad_80x80.svg" alt="" data-v-204f5510><div class="sub-navbar-toggle__des" data-v-204f5510>通用规则</div></div></div><div class="online-service" data-v-204f5510><button class="t-button t-button--variant-base t-button--theme-primary" type="button" href tabindex="0" data-v-204f5510><span class="t-button__text"><!--[--> 技术咨询 <!--]--></span></button></div><!----><!----><!----><!----></div></div></div><!----><!----><!--]--><!--]--></section><section class="t-layout content-layout" data-v-45cd89fe><!--[--><aside class="t-layout__sider wrap" id="sidebar" data-v-45cd89fe data-v-c3fa0a07><!--[--><div class="sidebar" data-v-c3fa0a07><div class="inner" data-v-c3fa0a07><ul class="sidebar-links sidebar-links-spacing" data-v-c3fa0a07><!--[--><li><!--[--><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->接入规范<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><div><a href="4011939746.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->商户收银台H5大字号规范<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011939778.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->微信支付二维码规范<!--]--></span><!----><!--]--></a></div><!--]--></li><!--]--></ul></section><!--]--></li><li><!--[--><div><a href="4011985891.html" class="active font sidebar-link ellipsis"><!--[--><span><!--[-->安全规范<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->名词表<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><div><a href="4011939826.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->支付模式<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011939975.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->名词解释<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011941162.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->参数规定<!--]--></span><!----><!--]--></a></div><!--]--></li><!--]--></ul></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->API安全<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><div><a href="4011941549.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->最佳安全实践<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011984638.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->安全与网络相关注意事项<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4012197402.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->HTTPS服务器配置<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!----></li><li><!----></li><li><!----></li><li><!----></li><li><!----></li><li><!----></li><!--]--></ul></section><!--]--></li><li><!--[--><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading ellipsis"><span><!--[--><span><!--[-->最佳实践<!--]--></span><!----><!--]--></span><span class="up arrow"></span></p><ul class="sidebar-links sidebar-group-items"><!--[--><li><!--[--><div><a href="4011984682.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->支付回调和查单实现指引<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011984721.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->回调通知注意事项<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011984794.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->专线商户Notify升级指引<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011984810.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->支付验收指引<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!--[--><div><a href="4011984887.html" class="sidebar-link ellipsis"><!--[--><span><!--[-->跨城冗灾方案<!--]--></span><!----><!--]--></a></div><!--]--></li><li><!----></li><!--]--></ul></section><!--]--></li><!--]--></ul></div></div><!--]--></aside><main class="t-layout__content" data-v-45cd89fe><!--[--><div class="page-container" data-v-45cd89fe><main class="page" data-v-45cd89fe><div class="page-inner-container" data-v-45cd89fe><div id="page-content" class="page-content" data-v-45cd89fe><h1 class="content-title" data-v-45cd89fe>安全规范</h1><span class="last-updated-date" data-v-45cd89fe> 更新时间：2024.12.11</span><div id="main-content" class="theme-default-content" data-v-45cd89fe><div data-v-45cd89fe><html><head></head><body><div class="iwiki-wrapper"><div class="iwiki-wrapper"><div><h2 class="iwiki-h2" id="1、签名算法"><span>1、签名算法</span></h2></div><p class="iwiki-p"><span><span><span><a href="https://pay.weixin.qq.com/doc/v2/tool/sign_verify" target="_blank">（签名校验工具）</a></span></span></span></p><div><p class="iwiki-p"><span>签名生成的通用步骤如下：</span></p></div><div><p class="iwiki-p"><span>第一步，设所有发送或者接收到的数据为集合M，将集合M内非空参数值的参数按照参数名ASCII码从小到大排序（字典序），使用URL键值对的格式（即key1=value1&amp;key2=value2…）拼接成字符串stringA。</span></p></div><div><p class="iwiki-p"><span>特别注意以下重要规则：</span></p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span>参数名ASCII码从小到大排序（字典序）；</span></p></li><li class="iwiki-li"><p class="iwiki-p"><span>如果参数的值为空不参与签名；</span></p></li><li class="iwiki-li"><p class="iwiki-p"><span>参数名区分大小写；</span></p></li><li class="iwiki-li"><p class="iwiki-p"><span>验证调用返回或微信主动通知签名时，传送的sign参数不参与签名，将生成的签名与该sign值作校验。</span></p></li><li class="iwiki-li"><p class="iwiki-p"><span>微信接口可能增加字段，验证签名时必须支持增加的扩展字段</span></p></li></ul><div><p class="iwiki-p"><span>第二步，在stringA最后拼接上APIv2密钥（密钥在代码中字段名为key）得到stringSignTemp字符串，并对stringSignTemp进行MD5运算，再将得到的字符串所有字符转换为大写，得到sign值signValue。&nbsp;注意：APIv2密钥的长度为32个字节。</span></p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span>APIv2密钥设置路径：</span><span><a href="http://pay.weixin.qq.com" target="_blank">微信商户平台</a></span><span>--&gt;账户中心--&gt;账户设置--&gt;API安全--&gt;设置API密钥</span></p></li></ul><div><p class="iwiki-p"><span>举例：</span></p></div><div><p class="iwiki-p"><span>假设传送的参数如下：</span></p></div><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>appid： wxd930ea5d5a258f4f</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>mch_id： 10000100</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>device_info： 1000</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>body： test</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">5</span><span class="iwiki-codeBlock-line"><span>nonce_str： ibuaiVcKdpRxkhJA</span></span></span></pre></div><div><p class="iwiki-p"><span>第一步：对参数按照key=value的格式，并按照参数名ASCII字典序排序如下：</span></p></div><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline lastline">1</span><span class="iwiki-codeBlock-line"><span>stringA="appid=wxd930ea5d5a258f4f&amp;body=test&amp;device_info=1000&amp;mch_id=10000100&amp;nonce_str=ibuaiVcKdpRxkhJA";</span></span></span></pre></div><div><p class="iwiki-p"><span>第二步：拼接APIv2密钥：</span></p></div><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>MD5签名方式：</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>stringSignTemp=stringA+"&amp;key=192006250b4c09247ec02edce69f6a2d" //注：key为商户平台设置的密钥key</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">3</span><span class="iwiki-codeBlock-line"><span>sign=MD5(stringSignTemp).toUpperCase()="9A0A8659F005D6984697E2CA0A9CF3B7" //注：MD5签名方式</span></span></span></pre></div><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>HMAC-SHA256签名方式：</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>stringSignTemp=stringA+"&amp;key=192006250b4c09247ec02edce69f6a2d" //注：key为商户平台设置的密钥key</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">3</span><span class="iwiki-codeBlock-line"><span>sign=hash_hmac("sha256",stringSignTemp,key).toUpperCase()="6A9AE1657590FD6257D693A078E1C3E4BB6BA4DC30B23E0EE2496E54170DACD6" //注：HMAC-SHA256签名方式，部分语言的hmac方法生成结果二进制结果，需要调对应函数转化为十六进制字符串。</span></span></span></pre></div><div><p class="iwiki-p"><span>最终得到最终发送的数据：</span></p></div><div class="iwiki-codeBlock-div" language="null"><img class="iwiki-codeBlock-copy" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5236a3a065efe1276d29855d7cad26f8_16x16.svg" width="20" height="20"><pre class="iwiki-codeBlock"><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber firstline">1</span><span class="iwiki-codeBlock-line"><span>&lt;xml&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">2</span><span class="iwiki-codeBlock-line"><span>&lt;appid&gt;wxd930ea5d5a258f4f&lt;/appid&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">3</span><span class="iwiki-codeBlock-line"><span>&lt;mch_id&gt;10000100&lt;/mch_id&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">4</span><span class="iwiki-codeBlock-line"><span>&lt;device_info&gt;1000&lt;/device_info&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">5</span><span class="iwiki-codeBlock-line"><span>&lt;body&gt;test&lt;/body&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">6</span><span class="iwiki-codeBlock-line"><span>&lt;nonce_str&gt;ibuaiVcKdpRxkhJA&lt;/nonce_str&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber">7</span><span class="iwiki-codeBlock-line"><span>&lt;sign&gt;9A0A8659F005D6984697E2CA0A9CF3B7&lt;/sign&gt;</span><span>
</span></span></span><span class="iwiki-codeBlock-lines"><span class="iwiki-codeBlock-linenumber lastline">8</span><span class="iwiki-codeBlock-line"><span>&lt;/xml&gt;</span></span></span></pre></div><div><h2 class="iwiki-h2" id="2、签名问题排查指引">2、签名问题排查指引</h2></div><div><p class="iwiki-p"><span>请求接口返回签名错误，可以按照以下方案排查：</span></p></div><div><p class="iwiki-p"><span><span><span>1、检查请求参数是否正确</span></span></span></p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span>注意参数是否区分大小写，参数大小写不正确将会导致签名错误</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>检查所有参数是否与文档完全一致</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>请求数据的编码是否正确，微信支付接口编码要求统一为UTF-8</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>签名原串是否存在被URLencode编码的参数，微信支付的签名原串要求使用参数的原值进行签名</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>请求参数是否存在特殊字符，或者字段长度不符的情况</span></span></p></li></ul><div><p class="iwiki-p"><span><span><span>2、检查商户号APIv2密钥是否正确</span></span></span></p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span>APIv2密钥设置路径：</span></span><span><span><a href="https://pay.weixin.qq.com/" target="_blank">微信商户平台</a></span></span><span><span>--&gt;账户中心--&gt;账户设置--&gt;API安全--&gt;设置API密钥</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>设置生效时间：一般为立刻生效，少数情况下会延迟几分钟，APIv2密钥没有修改次数限制，但有修改时间间隔限制</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>APIv2密钥设置是影响此商户号下所有接口的，请谨慎设置。如怀疑APIv2密钥错误，又担心影响其他接口，可以尝试设置与原先设置的一样的APIv2密钥</span></span></p></li></ul><table cellspacing="0" cellpadding="0" border="0" class=" iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel" width="100%"><table cellspacing="0" cellpadding="0" border="0" class="iwiki-panel-innerTable iwiki-panel-type-success iwiki-commonTable" width="100%"><tbody><tr><td class="iwiki-panel-iconTd success" width="24" height="24" valign="top"><svg focusable="false" aria-hidden="true" viewBox="0 0 16 16"><path d="M8 1C4.13 1 1 4.13 1 8C1 11.87 4.13 15 8 15C11.87 15 15 11.87 15 8C15 4.13 11.87 1 8 1ZM11.05 6.59L7.51 10.13C7.41 10.23 7.25 10.23 7.16 10.13L4.95 7.92C4.85 7.82 4.85 7.66 4.95 7.57L5.3 7.22C5.4 7.12 5.56 7.12 5.65 7.22L7.33 8.9L10.34 5.89C10.44 5.79 10.6 5.79 10.69 5.89L11.04 6.24C11.14 6.34 11.14 6.5 11.04 6.59H11.05Z" fill="currentColor"></path></svg></td><td class="iwiki-panel-inner" width="100%"><p class="iwiki-p"><span><span>注意</span></span></p><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span>APIv2密钥修改后，会存在新旧两份密钥，新密钥立即生效，旧密钥将在15天后自动失效（商户也可提前作废旧密钥）</span></p></li><li class="iwiki-li"><p class="iwiki-p"><span>若旧密钥未作废，无法再次修改密钥，需等待旧密钥失效或提前作废（在旧密钥更换的24小时后才能提前作废）</span></p></li></ul></td></tr></tbody></table></td></tr></tbody></table><div><h2 class="iwiki-h2" id="3、生成随机数算法">3、生成随机数算法</h2></div><div><p class="iwiki-p"><span><span>微信支付API接口协议中包含字段nonce_str，主要保证签名不可预测。我们推荐生成随机数算法如下：调用随机数函数生成，将得到的值转换为字符串。</span></span></p></div><div><h2 class="iwiki-h2" id="4、API证书">4、API证书</h2></div><div><p class="iwiki-p"><span><span>（1）获取API证书（</span></span><span><span><a href="https://kf.qq.com/faq/180824JvUZ3i180824YvMNJj.html" target="_blank">什么是api证书？如何升级？</a></span></span><span>）</span></p></div><div><p class="iwiki-p"><span><span>微信支付接口中，涉及资金回滚的接口会使用到API证书，包括退款、撤销接口。商家在申请微信支付成功后，收到的相应邮件后，可以按照指引下载API证书，也可以按照以下路径下载：</span></span><span><span><a href="http://pay.weixin.qq.com" target="_blank">微信商户平台</a></span></span><span><span>--&gt;账户中心--&gt;账户设置--&gt;API安全&nbsp;。证书文件说明如下：</span></span></p></div><div class="iwiki-tableNode-wrapper"><table class="iwiki-tableNode"><colgroup><col><col><col><col></colgroup><tbody><tr><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>证书附件</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>描述</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>使用场景</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>备注</span></span></p></th></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>pkcs12格式</span></span><br><span><span>（apiclient_cert.p12）</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>包含了私钥信息的证书文件，为p12(pfx)格式，由微信支付签发给您用来标识和界定您的身份</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>资金回滚（撤销、退款申请API）中调用</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>windows上可以直接双击导入系统，导入过程中会提示输入证书密码，证书密码默认为您的商户ID（如：10010000）</span></span></p></td></tr></tbody></table></div><div><p class="iwiki-p"><span><span>PHP等不能直接使用p12文件，而需要使用pem，为方便您使用，已为您直接提供以下两个证书在PHP环境中使用：</span></span></p></div><div class="iwiki-tableNode-wrapper"><table class="iwiki-tableNode"><colgroup><col><col><col><col></colgroup><tbody><tr><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>证书附件</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>描述</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>使用场景</span></span></p></th><th colspan="1" rowspan="1" class="iwiki-tableHeader" bgcolor="#f4f5f9" valign="middle" align="left"><p class="iwiki-p"><span><span>备注</span></span></p></th></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>证书pem格式</span></span><br><span><span>（apiclient_cert.pem）</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>从apiclient_cert.pem中导出证书部分的文件，为pem格式，请妥善保管不要泄露和被他人复制</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>资金回滚（撤销、退款申请API）中使用</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>您也可以使用openssl命令来自己导出：openssl&nbsp;pkcs12&nbsp;-clcerts&nbsp;-nokeys&nbsp;-in&nbsp;apiclient_cert.pem&nbsp;-out&nbsp;apiclient_cert.pem</span></span></p></td></tr><tr><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>证书密钥pem格式</span></span><br><span><span>（apiclient_key.pem）</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>从apiclient_key.pem中导出密钥部分的文件，为pem格式，请妥善保管不要泄露和被他人复制</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>资金回滚（撤销、退款申请API）中使用</span></span></p></td><td colspan="1" rowspan="1" class="iwiki-tableCell" bgcolor="white" valign="middle"><p class="iwiki-p"><span><span>您也可以使用openssl命令来自己导出：openssl&nbsp;pkcs12&nbsp;-nocerts&nbsp;-in&nbsp;apiclient_cert.pem&nbsp;-out&nbsp;apiclient_key.pem</span></span></p></td></tr></tbody></table></div><div><p class="iwiki-p"><span><span>（2）使用API证书</span></span></p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span>apiclient_cert.p12是商户证书文件，除PHP外的开发均使用此证书文件。</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>商户如果使用.NET环境开发，请确认Framework版本大于2.0，必须在操作系统上双击安装证书apiclient_cert.p12后才能被正常调用。</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>API证书调用或安装需要使用到密码，该密码的值为微信商户号（mch_id）</span></span></p></li></ul><div><p class="iwiki-p"><span><span>（3）API证书安全</span></span></p></div><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span>证书文件不能放在web服务器虚拟目录，应放在有访问权限控制的目录中，防止被他人下载；</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>建议将证书文件名改为复杂且不容易猜测的文件名；</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>商户服务器要做好病毒和木马防护工作，不被非法侵入者窃取证书文件。</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>如何使用微信API证书？</span></span></p><ul class="iwiki-ul"><li class="iwiki-li"><p class="iwiki-p"><span><span>推荐在代码中通过绝对路径引用证书文件（避免相对路径导致的引用失败）；</span></span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>调用接口时，按开发语言要求配置证书参数（如&nbsp;Python 的</span></span><code><span>requests</span></code><span>库通过</span><code><span>cert</span></code><span>参数传入，Java&nbsp;通过</span><code><span>KeyStore</span></code><span>加载）；</span></p></li><li class="iwiki-li"><p class="iwiki-p"><span><span>生产环境中，证书路径及密码建议通过环境变量或加密配置文件管理，禁止硬编码在代码中。</span></span></p></li></ul></li></ul><div><h2 class="iwiki-h2" id="5、商户回调API安全">5、商户回调API安全</h2></div><div><p class="iwiki-p"><span><span>在普通的网络环境下，HTTP请求存在DNS劫持、运营商插入广告、数据被窃取，正常数据被修改等安全风险。商户回调接口使用HTTPS协议可以保证数据传输的安全性。所以微信支付建议商户提供给微信支付的各种回调采用HTTPS协议。请参考：</span></span><span><span><a href="4012197402.html" target="_blank">HTTPS搭建指南</a></span></span><span>。</span></p></div></div><p class="iwiki-p">&nbsp;</p></div></body></html></div><div class="hr-line" data-v-45cd89fe></div></div><div class="feedback-and-moresupport" data-v-45cd89fe><div class="feedback-box" data-v-45cd89fe data-v-77eca616><div class="feedback-panel-text" data-v-77eca616> 文档是否有帮助 </div><!----><div class="feedback-panel-choices" data-v-77eca616><button class="feedback-option" data-v-77eca616><i class="icon help-icon" data-v-77eca616></i>是 </button><button class="feedback-option" data-v-77eca616><i class="icon no-help-icon" data-v-77eca616></i>否 </button></div></div></div><div class="relative-doc-and-moresupport" data-v-45cd89fe><div class="more-support" data-v-45cd89fe data-v-e0c53a30><div class="more-support__title" data-v-e0c53a30> 更多支持 </div><div class="more-support__lists" data-v-e0c53a30><!--[--><a href="https://pay.weixin.qq.com/doc/v3/partner/4012069852" target="_blank" data-v-e0c53a30>开发文档(服务商)</a><a href="https://pay.weixin.qq.com/doc/v2" target="_blank" data-v-e0c53a30>开发文档(V2版)</a><!--]--><a href="https://developers.weixin.qq.com/community/pay" target="_blank" data-v-e0c53a30>开发者社区</a><a href="https://open.weixin.qq.com/" target="_blank" data-v-e0c53a30>微信开放平台</a><a href="https://mp.weixin.qq.com/" target="_blank" data-v-e0c53a30>微信公众平台</a><a href="https://kf.qq.com/product/wechatpaymentmerchant.html" target="_blank" data-v-e0c53a30>腾讯客服</a></div></div></div></div><div class="sub-sidebar" data-v-45cd89fe data-v-7f9bf920><div class="toc" data-v-7f9bf920><div class="mb32" data-v-7f9bf920><div class="feedback-box" data-v-7f9bf920 data-v-77eca616><div class="feedback-panel-text" data-v-77eca616> 文档是否有帮助 </div><!----><div class="feedback-panel-choices" data-v-77eca616><button class="feedback-option" data-v-77eca616><i class="icon help-icon" data-v-77eca616></i>是 </button><button class="feedback-option" data-v-77eca616><i class="icon no-help-icon" data-v-77eca616></i>否 </button></div></div></div><div class="toc-container mb40" data-v-7f9bf920 data-v-c65b4426><!--[--><div class="toc-h2 toc-active toc-item" data-v-c65b4426><a href="4011985891.html#1、签名算法" title="1、签名算法" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>1、签名算法</span></a></div><div class="toc-h2 toc-item" data-v-c65b4426><a href="4011985891.html#2、签名问题排查指引" title="2、签名问题排查指引" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>2、签名问题排查指引</span></a></div><div class="toc-h2 toc-item" data-v-c65b4426><a href="4011985891.html#3、生成随机数算法" title="3、生成随机数算法" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>3、生成随机数算法</span></a></div><div class="toc-h2 toc-item" data-v-c65b4426><a href="4011985891.html#4、API证书" title="4、API证书" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>4、API证书</span></a></div><div class="toc-h2 toc-item" data-v-c65b4426><a href="4011985891.html#5、商户回调API安全" title="5、商户回调API安全" class="ellipsis" data-v-c65b4426><span data-v-c65b4426>5、商户回调API安全</span></a></div><!--]--></div><div class="support-container" data-v-7f9bf920 data-v-787fd1f1><a href="https://support.pay.weixin.qq.com/aidevhelper?from=wechatpaydoc" target="_blank" class="support-btn" data-v-787fd1f1><i class="support-icon" data-v-787fd1f1></i><span class="support-text" data-v-787fd1f1>AI开发助手</span></a></div></div><div class="toc-mobile" data-v-7f9bf920><div class="sub-sidebar-group" data-v-7f9bf920 data-v-08ae15f6><div class="group-item" data-v-08ae15f6><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202509/441b156fa07f0548ddda2a0b711b478e_20x20.svg" alt="" data-v-08ae15f6><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202509/441b156fa07f0548ddda2a0b711b478e_20x20.svg" alt="" data-v-08ae15f6><div class="group-info" data-v-08ae15f6> 元宝AI </div></div><div class="group-items" data-v-08ae15f6><div class="group-item" data-v-08ae15f6><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/5c7b6ed2432ae0401a49a60329a1c5c9_80x80.svg" alt="" data-v-08ae15f6><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/c2c45e34bb7e9c67c51b22550d44b813_80x80.svg" alt="" data-v-08ae15f6><div class="group-info" data-v-08ae15f6> 反馈 </div></div><div class="group-item" data-v-08ae15f6><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/55b0d9d534b0ccd145bcbe8e932f3053_80x80.svg" alt="" data-v-08ae15f6><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/88d0ba6a5d2578733aa9f3c586f07224_80x80.svg" alt="" data-v-08ae15f6><div class="group-info" data-v-08ae15f6> 目录 </div></div><div class="group-item" data-v-08ae15f6><img class="group-icon" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/70ba1309ab6ade7e84f4f6d006c15621_48x49.png" alt="" data-v-08ae15f6><img class="group-icon-hover" src="https://gtimg.wechatpay.cn/resource/xres/img/202409/eb04b4d41529b9413c0cba2a825c9d95_48x49.png" alt="" data-v-08ae15f6><div class="group-info" data-v-08ae15f6> 置顶 </div></div></div><!----><!----></div></div></div></div><!----></main><footer class="t-layout__footer footer" data-v-45cd89fe><!--[--><div class="footer-copyright" data-v-45cd89fe> Powered By Tencent &amp; Tenpay Copyright 2005-2025 Tenpay All Rights Reserved. </div><div class="footer-copyright footer-copyright-mobile" data-v-45cd89fe> Powered By Tencent &amp; Tenpay<br data-v-45cd89fe>Copyright 2005-2025 Tenpay All Rights Reserved. </div><!--]--></footer></div><!--]--></main><!--]--></section><!--]--></section><!--]--></div>
        <div id="teleported"></div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </body>
    </html>