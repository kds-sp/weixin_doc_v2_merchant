<!DOCTYPE html>
    <html>
      <head>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <meta />
        
    <title>开发指引_产品文档（V2）|微信支付商户文档中心</title><meta>
    <meta>
    
    
    
    
  
      </head>
      <body>
        
        <div><section><header><div><div><div><a><img></a></div><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div><div><div> 文档中心 </div><img></div></div></div><div><img><div><a>首页</a><a>接入指引</a><a>产品中心</a><a>解决方案</a><a>文档中心</a><a>接入微信支付</a></div></div></header><section><div><div><div><div><a>产品文档（V2）</a><a>通用规则</a><a>SDK&amp;开发工具</a><a>更新日志</a></div></div><div><div><div><img><div>产品文档（V2）</div></div></div><div><button><span> 技术咨询 </span></button></div></div></div></div></section><section><aside><div><div><ul><li><section><p><span><span>支付产品</span></span><span></span></p><ul><li><section><p><span><span>付款码支付</span></span><span></span></p><ul><li><div><a><span>支付账户</span></a></div></li><li><div><a><span>场景介绍</span></a></div></li><li><div><a><span>验证密码规则</span></a></div></li><li><div><a><span>案例介绍</span></a></div></li><li><div><a><span>协议规则</span></a></div></li><li><div><a><span>开发指引</span></a></div></li><li><section><p><span><span>API列表</span></span><span></span></p></section></li><li><div><a><span>常见问题</span></a></div></li></ul></section></li><li><section><p><span><span>JSAPI支付</span></span><span></span></p></section></li><li><section><p><span><span>Native支付</span></span><span></span></p></section></li><li><section><p><span><span>APP支付</span></span><span></span></p></section></li><li><section><p><span><span>H5支付</span></span><span></span></p></section></li><li><section><p><span><span>小程序支付</span></span><span></span></p></section></li></ul></section></li><li><section><p><span><span>运营工具</span></span><span></span></p><ul><li><section><p><span><span>现金红包</span></span><span></span></p></section></li><li><section><p><span><span>小程序红包</span></span><span></span></p></section></li><li><section><p><span><span>付款到银行卡</span></span><span></span></p></section></li><li></li><li><section><p><span><span>委托代扣</span></span><span></span></p></section></li><li></li><li></li></ul></section></li><li><section><p><span><span>扩展工具</span></span><span></span></p><ul><li><section><p><span><span>分账</span></span><span></span></p></section></li><li><section><p><span><span>清关报关</span></span><span></span></p></section></li><li></li><li></li><li></li></ul></section></li></ul></div></div></aside><main><div><main><div><div><h1>开发指引</h1><span> 更新时间：2025.03.21</span><div><div><html><head></head><body><div><div><p><span><span>根据商户具体的情况，付款码支付接入模式可分为：商户后台接入和门店接入；</span></span></p></div><div><p><span><span>根据用户是否需要输入支付密码可分为：免密模式和验密模式。</span></span></p></div><div><h2><span>1、接入模式-商户后台接入</span></h2></div><div><p><span><span>该模式适合具备统一后台系统的商户。门店收银台与商户后台通信，商户后台系统负责与微信支付系统发送交易请求和接收返回结果。</span></span></p></div><div><p><span><img></span> </p></div><div><p><span><span>图5.4 商户后台接入付款码支付</span></span></p></div><h2><span>2、免密支付流程</span></h2><p><span><span>本节以商户后台接入模式说明支付流程，请参看以下时序图：</span></span></p><p>&nbsp;</p><div><p><span><img></span> </p></div><div><p><span><span>图5.6 付款码支付免密流程时序图</span></span></p></div><p><span><span><span>流程详细说明：</span></span></span></p><p><span><span>（1）收银员在商户收银台生成支付订单，向用户展示支付金额；</span></span></p><p><span><span>（2）用户打开微信客户端，点击“我的钱包”，选择“付款码”，进入条码界面；</span></span></p><p><span><span>（3）使用扫码设备读取用户手机屏幕上的条码；</span></span></p><p><span><span>（4）扫码设备将读取的信息上传给门店收银台；</span></span></p><p><span><span>（5）门店收银台得到支付信息后，向商户收银后台发起支付请求。</span></span></p><p><span><span>（6）商户后台对门店收银台的支付请求进行处理，生成签名后调用【</span></span><span><a>付款码支付API</a></span><span>】向微信支付系统发起支付请求。</span></p><p><span><span>（7）微信支付系统得到商户侧的支付请求之后会对请求进行验证，验证通过之后会对请求数据进行处理，最后将处理后的支付结果返回给商户收银后台。如果支付成功，微信支付系统会将支付结果返回给商户，同时把支付结果通知给用户（以短信、微信消息的形式通知）。</span></span></p><p><span><span>（8）商户收银后台对得到的支付结果进行签名验证和处理，再将支付结果返回给门店收银台。</span></span></p><p><span><span>（9）收银员看到门店收银台的支付结果后给用户发货。</span></span></p><h2><span>3、验密支付流程</span></h2><p><span><span>场景交互与免密模式相同，不同的是在商户调用【</span></span><span><span><a>付款码支付API</a></span></span><span>】发起支付请求之后，微信支付后台提示用户输入密码确认支付，接口同步返回USERPAYING状态，商户系统再轮询调用查询订单接口来确认当前用户是否已经支付成功。</span></p><p><span><span>以下时序图说明验密支付流程：</span></span></p><div><p><span><img></span> </p></div><div><p><span><span>图5.7 付款码支付验证密码流程时序图</span></span></p></div><p><span><span><span>流程详细说明：</span></span></span></p><p><span><span>（1）收银员在商户收银台生成支付订单，向用户展示支付金额；</span></span></p><p><span><span>（2）用户打开微信客户端，点击“我的钱包”，选择“付款码”，进入条码界面；</span></span></p><p><span><span>（3）使用扫码设备读取用户手机屏幕上的条码；</span></span></p><p><span><span>（4）扫码设备将读取的信息上传给门店收银台；</span></span></p><p><span><span>（5）商户门店生成订单后，收银台向后台系统发起支付请求。</span></span></p><p><span><span>（6）商户后台对门店收银台的支付请求进行处理，生成签名后调用【</span></span><span><span><a>付款码支付API</a></span></span><span>】向微信支付系统发起支付请求。</span></p><p><span><span>（7）微信支付系统得到商户侧的支付请求之后会对请求进行验证，验证通过后判断当前用户需要输入密码。</span></span></p><p><span><span>（8）微信支付系统返回USERPAYING状态，商户后台系统将应答结果返回给商户门店收银台。</span></span></p><p><span><span>（9）微信支付系统通知用户微信客户端输入密码。</span></span></p><p><span><span>（10）用户得到输入密码提示后，确认支付并输入密码。</span></span></p><p><span><span>（11）完成密码输入，提交微信支付。</span></span></p><p><span><span>（12）微信客户端在用户完成支付后提示微信支付后台系统返回的支付结果，而且微信支付系统会通过短信、微信消息给用户发送支付结果提醒。</span></span></p><p><span><span>（13）商户收银台得到USERPAYING状态后，经过商户后台系统调用【</span></span><span><span><a>查询订单API</a></span></span><span>】查询实际支付结果。</span></p><p><span><span>（14）如果支付结果仍为USERPAYING，则每隔5秒循环调用【</span></span><span><span><a>查询订单API</a></span></span><span>】判断实际支付结果，如果用户取消支付或累计30秒用户都未支付，商户收银台退出查询流程后继续调用【</span><span><span><a>撤销订单API</a></span></span><span>】撤销支付交易。</span></p><h2><span>4、异常处理</span></h2><p><span><span>用户遇到支付异常，请按如下说明处理</span></span></p><p><span><span>（1）用户微信端弹出系统错误提示框，用户可在交易列表查看交易情况，如果未找到订单，需要商户重新发起支付交易；如果订单显示成功支付，商户收银系统再次调用【</span></span><span><span><a>查询订单API</a></span></span><span>】查询实际支付结果；</span></p><p><span><span>（2）用户微信端弹出支付失败提示，例如：余额不足，信用卡失效。需要重新发起支付；</span></span></p><p><span><span>（3）当交易超时或支付交易失败，商户收银系统必须调用【</span></span><span><span><a>撤销订单API</a></span></span><span>】，撤销此交易。</span></p><p><span><span>（4）由于银行系统异常、用户余额不足、不支持用户卡种等原因使当前支付交易失败，商户收银系统应该把错误提示明确展示给收银员。</span></span></p><p><span><span>（5）根据返回的错误码，判断是否需要撤销交易，具体详见API返回错误码列表</span></span></p><p>&nbsp;</p></div></body></html></div><div></div></div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><div> 更多支持 </div><div><a>开发文档(服务商)</a><a>开发文档(V2版)</a><a>开发者社区</a><a>微信开放平台</a><a>微信公众平台</a><a>腾讯客服</a></div></div></div></div><div><div><div><div><div> 文档是否有帮助 </div><div><button><i></i>是 </button><button><i></i>否 </button></div></div></div><div><div><a><span>1、接入模式-商户后台接入</span></a></div><div><a><span>2、免密支付流程</span></a></div><div><a><span>3、验密支付流程</span></a></div><div><a><span>4、异常处理</span></a></div></div><div><a><i></i><span>AI开发助手</span></a></div></div><div><div><div><img><img><div> 元宝AI </div></div><div><div><img><img><div> 反馈 </div></div><div><img><img><div> 目录 </div></div><div><img><img><div> 置顶 </div></div></div></div></div></div></div></main><footer><div> Powered By Tencent &amp; Tenpay Copyright 2005-2025 Tenpay All Rights Reserved. </div><div> Powered By Tencent &amp; Tenpay<br>Copyright 2005-2025 Tenpay All Rights Reserved. </div></footer></div></main></section></section></div>
        <div></div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </body>
    </html>